\documentclass[twocolumn,10pt]{IFTOMM}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{calrsfs} % F체r Kalligraphie-F 
%\newcommand{\gbf}[1] {\mbox{\boldmath${#1}$\unboldmath}}% inserts 'g'reek 'b'old 'f'ace symbols eg. \gbf{\alpha}.
\newcommand{\bm}[1]{\boldsymbol{#1}}

\newcommand{\ortvek}[4]{{ }_{(#1)}{\boldsymbol{#2}}^{#3}_{#4} }
\newcommand{\vek}[3]{\boldsymbol{#1}^{#2}_{#3}}
\newcommand{\rotmat}[2]{{{ }^{#1}\boldsymbol{R}}_{#2}}
\newcommand{\transp}[0]{{\mathrm{T}}}
\newcommand{\ks}[1]{{\mathcal{F}}_{#1}}

% F체r Deutsche Umlaute
\usepackage{ngerman}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{color}
\graphicspath{{./figures/}}

\begin{document}
%PAPER NUMBER: will be provided by the organization for accepted paper
\def\papernumber{IK xxx}
\def\conference_name{15th IFToMM World Congress, Krakow, Poland, 30 June--4 July, 2019}
%PAPER TITLE
\title{Resolution of Functional Redundancy for 3T2R Robot Tasks  \\ using Two Sets of Reciprocal Euler Angles}

\author{
    \begin{tabular}{cccc}
    M.\ Schappler\thanks{moritz.schappler@imes.uni-hannover.de}
& S.\ Tappe\thanks{svenja.tappe@imes.uni-hannover.de}
& T.\ Ortmaier\thanks{tobias.ortmaier@imes.uni-hannover.de}\\
    \multicolumn{3}{c}{Institut f체r mechatronische Systeme} \\
    \multicolumn{3}{c}{Leibniz Universit채t Hannover, Hannover, Germany}
    \end{tabular}
}

%ESSENTIAL, will not work otherwise
\maketitle

%ABSTRACT
\begin{abstract}
Robotic tasks like welding or drilling with three translational and only two rotational degrees of freedom (``3T2R'') are of high industrial relevance but are rather scarcely addressed in scientific publications.
Existing solutions for the resolution of the functional redundancy of robotic manipulators performing these tasks either expand the full kinematic formulation or reduce it in intermediate steps.
The present paper presents an approach to reduce the kinematic formulation from the start to solve the problem in a simple way.
This is done by using a set of reciprocal Euler angles to describe the end-effector orientation and the orientation error in inverse kinematics.
\end{abstract}

%KEYWORDS
\begin{keywords}
functional redundancy, redundancy resolution, reciprocal Euler angles, inverse kinematics, robots, five-DoF task, 3T2R task
\end{keywords}

\section{Introduction}
\label{sec:Intro}
Since the first papers in the 1980s the fields of inverse kinematics \cite{GoldenbergBenFen1985} and the resolution of \emph{intrinsic} redundancy \cite{Yoshikawa1984} in robotics have been extensively elaborated upon.
Inverse kinematics for robot manipulators can be approached with gradient-based numeric approaches on the level of joint positions and joint velocity.
Due to the nonlinearity of rotation on position level \cite{GoldenbergBenFen1985}, the latter is usually preferred.

The kinematics of robots performing tasks with five instead of six degrees of freedom (DoF) has drawn much less attention, even if many industrial relevant tasks only require 5-DoF such as the class of 3T2R-tasks where the task rotation is axis-symmetric.
These tasks comprise amongst others arc welding \cite{HuoBar2005}, drilling \cite{ZhuQuCaoYan2013,GuoDonKe2015}, spray-painting \cite{FromGra2010}, laser-cutting, milling, glueing and deburring and are transfered to a greater extend to robotic manipulators in the automotive or aviation industry.

Since the standard industrial robots have six DoF, one degree of \emph{functional} redundancy exists which allows to improve performance characteristics of the robots while achieving a valid pose to perform one of the aforementioned tasks.
To be able to incorporate performance optimization into inverse kinematics via the well-established gradient projection method \cite{Yoshikawa1984}, either the joint space can be augmented or the task space can be reduced \cite{Huo2009}.
Augmenting the joint space is possible by inserting an additional joint for the rotation around the task's axis of symmetry (``tool axis'') \cite{Baron2000}.
Reducing the task space can be performed by orthogonal decomposition of the end-effector twist \cite{HuoBar2005}, removing the row of the Jacobian corresponding to the tool axis \cite{Zlajpah2017}, the construction of the Jacobian Nullspace based upon geometric properties of the task \cite{LegerAng2016} or constructing a cone or pyramid resulting from the tool axis with an additional range of tolerance for tilt angles \cite{FromGra2010}.

Another possibility for the resolution of the functional redundancy is a cascaded optimization where the inner loop calculates the inverse kinematics with standard methods and the outer loop optimizes the performance index.
The optimization can be performed by evaluating the index on a range of rotation angles around the tool axis \cite{ZhuQuCaoYan2013} or by using the incremental change of the rotation around the tool axis directly to adapt the joint angles \cite{GuoDonKe2015}.

The choice of performance indices aims to improve the task execution with measures such as the joint positions quadratic \cite{HuoBar2005} or hyperbolic \cite{ZhuQuCaoYan2013} distances from the their limits, singularity avoidance via Frobenius-norm condition number \cite{ZhuQuCaoYan2013}, squared condition number \cite{LegerAng2016} or a combination of manipulability and condition number of the Jacobian \cite{HuoBar2008} or stiffness \cite{GuoDonKe2015}.

The characteristic length required to normalize the Jacobian for the performance indices can be either chosen constant regarding the robot geometry \cite{ZhuQuCaoYan2013} or as an additional optimization parameter \cite{LegerAng2016}.

The existing methods each have drawbacks that are avoided by using the new method presented in this paper:
\begin{itemize}
    \item Augmenting the joint space \cite{Baron2000} increases the computational cost and can lead to an ill-conditioned Jacobian \cite{HuoBar2008}.
    \item Using a nested optimization \cite{ZhuQuCaoYan2013,GuoDonKe2015} does not allow using the well-proven gradient projection method and does not work if the tool axis is aligned parallel to the last robot joint (``pointing configuration'') \cite{GuoDonKe2015}.
    \item In \cite{Zlajpah2017} the tool-axis rotation of the end-effector has to be calculated and canceled out in the null-space.
    \item Describing the tool axis with two points requires to define a distance between these points, which has to be chosen to gain a good conditioning of the optimization problem \cite{LegerAng2016}.
    \item All methods have a high mathematical level of abstraction e.\,g. using orthogonal decomposition \cite{HuoBar2008}, linear matrix inequalities and convex optimization \cite{FromGra2010}, rotation and component-selection of the vector part of the quaternion orientation error \cite{Zlajpah2017} or sequential quadratic programming \cite{LegerAng2016}.
\end{itemize}

As an alternative to the existing methods, we present an approach of expressing the orientation of the end-effector and the orientation error between desired and actual end-effector orientation with a set of reciprocal Euler angles.
Reciprocity for sets of Euler angles is defined in this paper as successive rotations around elementary axes that have mutually switched order.
By this definition, the rotation component belonging to the tool axis in 3T2R tasks is always the same for the absolute orientation and for the orientation error.
The effect of the tool axis can then be eliminated from the kinematic equations.
This allows to express the kinematics equation in minimal form which makes it easy to use the gradient projection method to incorporate performance indices.

The contributions of this paper are
\begin{itemize}
    \item A new formulation for the kinematics problem for robots performing 3T2R-tasks,
    \item an application of the formulation leading to an efficient solution for inverse kinematics with functional redundancy,
    \item examples on the performance of the implementation regarding computation and convergence,
    \item the extension of the formalism on parallel robots.
\end{itemize}

The remainder of the paper is structured as follows: The idea of kinematics description using sets of reciprocal Euler angles is elaborated upon in Sec.\, \ref{sec:RecEulAng}.
Their application in resolving the functional redundancy in inverse kinematics of 3T2R tasks is shown in Sec.\,\ref{sec:ResFuncRed}.
Sec.\,\ref{sec:ParRobKinConstr} gives an outlook to the definition of kinematic constraints for parallel robots. 
Simulative results for the inverse kinematics of serial robots in 3T2R tasks is presented in Sec.\,\ref{sec:SimEvalSerRobIK} to support the presented approach. Sec.\,\ref{sec:Conclusion} concludes the paper.

\section{Using reciprocal Euler Angles for Robot Kinematics}
\label{sec:RecEulAng}

The core of solving the inverse kinematics problem of robot manipulators for tasks with only two rotational degrees of freedom is the nonlinearity of rotation.
Rotation can be described using rotation matrices, Euler angles, rotation axis and angle its derivations like quaternions or the Rodrigues vector.
In contrast to all other notations, consecutive elementary rotations like Euler angles can be reduced to adapt for tasks only requiring two rotatory DoF.

\subsection{Kinematics Description}
\label{sec:RecEulAng_KinDesc}

We assume a serial kinematic chain with joint positions $\bm{q}$ and the forward kinematics
%
\begin{equation}
\bm{x}
=
\begin{pmatrix}
\bm{x}_{\mathrm{t}}^\transp & \bm{x}_{\mathrm{r}}^\transp
\end{pmatrix}^\transp
=
\bm{f} (\bm{q})
\end{equation}  
%
describing the end-effector frames $\ks{E}$ position 
%
\begin{equation}
\bm{x}_{\mathrm{t}}
=
\ortvek{0}{r}{}{0E}
\label{equ:xt_def}
\end{equation}  
%
and orientation 
%
\begin{equation}
\rotmat{0}{E}=\bm{R}(\bm{x}_{\mathrm{r}})
=
\begin{pmatrix}\vek{n}{}{Ex} & \vek{o}{}{Ex} & \vek{a}{}{Ex}\end{pmatrix}
\end{equation}  
% 
with respect to the base frame $\ks{0}$ expressed in a set $\bm{\beta}$ of X-Y-Z-Euler angles
%
\begin{equation}
\bm{x}_{\mathrm{r}}
=
\begin{pmatrix}
\beta_1  & \beta_2 & \beta_3
\end{pmatrix}^{\mathrm{T}}
\label{equ:xr_def}
\end{equation} 
%
using without loss of generality\footnote{other sets of Euler angles with the same properties may be used as well}
%
\begin{equation}
\bm{R}(\bm{\beta}) = \bm{R}_x(\beta_1) \bm{R}_y(\beta_2) \bm{R}_z(\beta_3) \in \mathrm{SO(3)}.
\label{equ:def_rmat_xyz}
\end{equation}
%
The deviation between the desired end-effector frame $\ks{Ex}$ expressed with $\bm{x}$ and the actual robots end-effector frame $\ks{Eq}$ expressed with $\bm{f}(\bm{q})$ with 
%
\begin{equation}
\bm{\Phi}=\begin{pmatrix}
\bm{\Phi}_{\mathrm{t}} & \bm{\Phi}_{\mathrm{r}}
\end{pmatrix}^\transp \in {\mathbb{R}}^{6}
\end{equation}
%
where the translational part 
%
\begin{equation}
\bm{\Phi}_{\mathrm{t}}(\bm{q}_i,\bm{x}) = \ortvek{0}{r}{}{E}(\bm{q}) - \ortvek{0}{r}{}{E}(\bm{x}_{\mathrm{t}}) \in {\mathbb{R}}^{3}
\end{equation}
%
is the vector from $\ks{Ex}$ to $\ks{Eq}$.
The rotational part
%
\begin{align}
\bm{\Phi}_{\mathrm{r}}(\bm{q},\bm{x}) &= \begin{pmatrix}
\alpha_1  & \alpha_2 & \alpha_3
\end{pmatrix}^\transp  \\
&=\bm{\alpha}\left(\rotmat{0}{Ex}^\transp (\bm{x}_{\mathrm{r}})\rotmat{0}{Eq}(\bm{q})\right) \in {\mathbb{R}}^{3}
\end{align}
%
of this ``residual vector'' is also chosen as a set of Euler angles $\bm{\alpha}$ \cite{GoldenbergBenFen1985}.
The Euler angle convention of the residual $\bm{\alpha}$ can be chosen independently of the choice for the orientation representation in $\rotmat{0}{E}$ or $\bm{x}_{\mathrm{r}}$.
The intuitive approach of choosing
%
\begin{equation}
\bm{R}(\bm{\alpha}) := \bm{R}_x(\alpha_1) \bm{R}_y(\alpha_2) \bm{R}_z(\alpha_3) \in \mathrm{SO(3)}
\end{equation}
%
the same way as $\bm{\beta}$ leads to a set of transformations depicted in Fig.\,\ref{fig:frames_6dof} where the intermediate steps of the single elementary rotations are omitted since they have no technical meaning.
Using this convention an adaption to tasks with functional redundancy is only possible with the methods described in Sec.\,\ref{sec:Intro}

\begin{figure}[tb!]
    \input{./figures/frame_comparison_6dof.pdf_tex}
    \caption{Overview of the different frames for 6-dof tasks with standard Euler-angle notation.}
    \label{fig:frames_6dof}
\end{figure} 

\subsection{Effect of the reciprocal Euler Angles}
\label{sec:RecEulAng_effect}



\begin{figure}[tb!]
    \input{./figures/frame_comparison_5dof.pdf_tex}
    \caption{overview of the different frames for 5-dof tasks with reciprocal Euler-angle notation.}
    \label{fig:frames_5dof}
\end{figure} 


%\begin{align}
%\rotmat{Ex}{Eq}(\bm{x},\bm{q}) 
%& = \rotmat{0}{Ex}^\transp (\bm{x})\rotmat{0}{Eq}(\bm{q}) \\
%&={}_{(Ex)}\begin{pmatrix}
%\vek{n}{}{Eq}(\bm{x}_{\mathrm{r}}) & \vek{o}{}{Eq}(\bm{x}_{\mathrm{r}}) & \vek{a}{}{Eq}(\bm{x}_{\mathrm{r}})
%\end{pmatrix}
%\end{align}

It is apparent, that using $\bm{\alpha}$ as defined in the previous subsection\,\ref{sec:RecEulAng_KinDesc}, all three components of $\bm{x}_{\mathrm{r}}=\bm{\beta}$ influence the three unit vectors $\bm{n}_{Ex}$, $\bm{o}_{Ex}$, $\bm{a}_{Ex}$ of the rotation matrix $\rotmat{0}{E}(\bm{x})$.

To encounter this issue we now choose the Euler angle convention $\bm{\alpha}$ for the orientation error to be 
%
\begin{equation}
\bm{R}(\bm{\alpha}) := \bm{R}_z(\alpha_3) \bm{R}_y(\alpha_2) \bm{R}_x(\alpha_1) \in \mathrm{SO(3)}.
\label{equ:def_rmat_zyxr}
\end{equation}
%
This set of $Z$-$Y$-$X$-Euler angles $\bm{\alpha}$ is defined in this paper as being \emph{reciprocal} to the $X$-$Y$-$Z$-convention $\bm{\beta}$ for the absolute orientation.
The notation corresponds to successive $X$-$Y$-$Z$ rotations $\bm{\alpha}$ about \emph{fixed} axes with the ambition of having thecorresponding third entries $\alpha_3$ and $\beta_3$.
The permutation in (\ref{equ:def_rmat_zyxr}) does not affect the calculation and the term ``$Z$-$Y$-$X$-Euler angles'' will be used further in this paper.

% from (\ref{equ:xt_def}),(\ref{equ:xr_def})
Similar to the end-effector operational space coordinates $\bm{x}$ we define the task space to have the coordinates
%
\begin{equation}
\bm{\eta}
=
\begin{pmatrix}
\bm{\eta}_{\mathrm{t}} \\
\bm{\eta}_{\mathrm{r}}
\end{pmatrix}
\end{equation}  
%
with the unchanged translational part
%
\begin{equation}
\bm{\eta}_{\mathrm{t}}
=
\bm{x}_{\mathrm{t}}
=
\ortvek{0}{r}{}{0E}
\end{equation}  
%
relating to $\bm{x}$ and the modified rotational part
%
\begin{equation}
\bm{\eta}_{\mathrm{r}}
=
\begin{pmatrix}
\beta_1  & \beta_2
\end{pmatrix}^\transp
\end{equation}
%
where the last rotation $\beta_3$ around the $z$-axis is not included since it corresponds to a rotation around the tool axis in 3T2R tasks and is a degree of freedom which can be set arbitrarily.

We now distinguish the frames $\ks{A1}$ and $\ks{A2}$ resulting from intermediate elementary rotations sketched in Fig.\,\ref{fig:frames_5dof} with the partial frame rotation to the desired frame
%
\begin{align}
\rotmat{0}{A1} 
&= 
\bm{R}_x(\beta_1) \bm{R}_y(\beta_2)\\
&=
\begin{pmatrix}
\vek{n}{}{A1} & \vek{o}{}{A1} & \vek{a}{}{A1}
\end{pmatrix} \nonumber
\end{align}
%
and the partial frame rotation
%
\begin{align}
\rotmat{0}{A2} 
&= 
\rotmat{0}{Eq}(\bm{q})
\left(\bm{R}_x(\alpha_1) \bm{R}_y(\alpha_2)\right)^\transp \\ 
&=
\begin{pmatrix}
\vek{n}{}{A2} & \vek{o}{}{A2} & \vek{a}{}{A2}
\end{pmatrix}\nonumber
\end{align}
%
from the actual frame and the $x$- and $y$-axis error components.

The frames $\ks{A1}$, $\ks{A2}$ and $\ks{Ex}$ all share the same $z$-axis
%
\begin{equation}
\vek{a}{}{Ex}
=
\vek{a}{}{A1}
=
\vek{a}{}{A2}
\end{equation}
%
which is also the tool axis as can be seen in Fig.\,\ref{fig:frames_5dof}.

Since the tool axis rotation $\beta_3$ and the orientation error component $\alpha_3$ are defined around the same axis, $\beta_3$ only influences $\alpha_3$ and not $\alpha_1$ and $\alpha_2$ as derived in the appendix \ref{sec:appendix_eulerreciproc} and can be expressed by
%
\begin{align}
\alpha_1&=\alpha_1(\bm{q},\beta_1,\beta_2) = \alpha_1(\bm{q},\bm{\eta}) \label{equ:alpha1_dep_beta},\\
\alpha_2&=\alpha_2(\bm{q},\beta_1,\beta_2) = \alpha_2(\bm{q},\bm{\eta}) \label{equ:alpha2_dep_beta},\\
\alpha_3&=\alpha_3(\bm{q},\beta_1,\beta_2,\beta_3) = \alpha_3(\bm{q},\bm{x})  \label{equ:alpha3_dep_beta}.
\end{align}
%
This property of the reciprocal Euler angles allows a kinematic description of robots in 3T2R tasks, as elaborated in the next sections

\subsection{Application on 3T2R Tasks}

%\subsubsection{Kinematics formulation}

We now describe the kinematic condition for the 3T2R problem as

\begin{equation}
\bm{\Psi}=\begin{pmatrix}
\bm{\Psi}_{\mathrm{t}} & \bm{\Psi}_{\mathrm{r}}
\end{pmatrix}^\transp \in {\mathbb{R}}^{5}
\end{equation}

\begin{equation}
\bm{\Psi}_{\mathrm{t}}(\bm{q}_i,\bm{\eta}) = \ortvek{0}{r}{}{E}(\bm{q}) - \ortvek{0}{r}{}{E}(\bm{\eta}_{\mathrm{t}}) \in {\mathbb{R}}^{3}
\end{equation}



\begin{align}
\bm{\Psi}_{\mathrm{r}}(\bm{q},\bm{\eta}) &= 
\begin{pmatrix}
\alpha_1  & \alpha_2
\end{pmatrix}^\transp  \\
&=
\begin{pmatrix} \bm{1}_{2 \times 2} & \bm{0}_{2 \times 1}\end{pmatrix} \bm{\Phi} (\bm{q},\bm{x}) \\
&= \begin{pmatrix} \bm{1} & \bm{0}\end{pmatrix} \bm{\alpha}\left(\rotmat{0}{A1}^\transp (\bm{\eta}_{\mathrm{r}})\rotmat{0}{Eq}(\bm{q})\right) \in {\mathbb{R}}^{2}
\end{align}

The condition $\bm{\Psi}=\bm{0}$ leads to a valid configuration of positioning the ed-effector and orientation of the tool-axis.




%\begin{align}
%\rotmat{0}{Eq}(\bm{q})
%&= \rotmat{0}{Ex}(\bm{x}) \rotmat{Ex}{Eq}(\bm{x},\bm{q}) \nonumber \\
%&= \bm{R}_x(\beta_1) \bm{R}_y(\beta_2) \bm{R}_z(\beta_3) \bm{R}_z(\alpha_3) \bm{R}_y(\alpha_2)\bm{R}_x(\alpha_1) \nonumber \\
%&= \bm{R}_x(\beta_1) \bm{R}_y(\beta_2) \bm{R}_z(\beta_3 + \alpha_3) \bm{R}_y(\alpha_2)\bm{R}_x(\alpha_1) \nonumber 
%\end{align} 
%
%Since 
%
%\begin{equation}
%\beta_3 = - \alpha_3
%\end{equation}  
%
%\begin{equation}
%\bm{R}_x(\beta_1) \bm{R}_y(\beta_2) = \rotmat{0}{Eq}(\bm{q})
%\bm{R}_x^\transp(\alpha_1)\bm{R}_y^\transp(\alpha_2) 
%\end{equation} 

%\begin{equation}
%\bm{\eta}_{\mathrm{r}}
%=
%\bm{\eta}_{\mathrm{r}}
%(\alpha_1, \alpha_2, \bm{q})
%\end{equation}

%\subsubsection{Inverse Kinematics}


Following \cite{GoldenbergBenFen1985}, the inverse kinematics problem for serial link robots with 6-DoF can be derived with the Taylor series of the nonlinear function 

\begin{equation}
\bm{\Phi}(\bm{q}^{k+1},\bm{x}) = 
\bm{\Phi}(\bm{q}^{k},\bm{x})
+
\frac{\partial}{\partial \bm{q}} \bm{\Phi}(\bm{q}^k,\bm{x}) \biggr\rvert_{\bm{q}^k} (\bm{q}^{k+1} - \bm{q}_i^k)
\end{equation}

where $\bm{\Phi}_{\partial\bm{q}}=(\partial \bm{\Phi} / \partial \bm{q})$ is the ``Jacobian matrix corresponding to the residual vector'' $\bm{\Phi}$ from REF.

For 3T2R tasks we can define in the same way
 
\begin{equation}
\bm{\Psi}(\bm{q}^{k+1},\bm{x}) = 
\bm{\Psi}(\bm{q}^{k},\bm{x})
+
\frac{\partial}{\partial \bm{q}} \bm{\Psi}(\bm{q},\bm{x}) \biggr\rvert_{\bm{q}^k} (\bm{q}^{k+1} - \bm{q}_i^k)
\end{equation}

With the condition for solution of the inverse kinematics in the next step

\begin{equation}
\bm{\Psi}(\bm{q}^{k+1},\bm{x})=\bm{0}
\end{equation}

the increment of the joint angles towards this solution is

\begin{equation}
\Delta \bm{q}^k
=
\left(\frac{\partial \bm{\Psi}(\bm{q},\bm{x})}{\partial \bm{q}}\biggr\rvert_{\bm{q}^k}\right)^{\dagger}
(\bm{0} - \bm{\Psi}(\bm{q}^{k},\bm{x}))
\end{equation}  




\subsection{Remarks on the Implementation}
\label{sec:RecEulAng_implement}
This approach does not use the classical geometric Jacobian of the serial link manipulator for the rotation part.
However the partial derivatives ... in equations REF can be implemented efficiently by exploiting the chain rule an d sparsity.

To simplify calculations, we write rotation matrices as vectors with

\begin{equation}
\bm{R}=\begin{pmatrix}
\bm{n} & \bm{o} & \bm{a}
\end{pmatrix}
\Rightarrow
\overline{\bm{R}}=\begin{pmatrix}
\bm{n} \\ \bm{o} \\ \bm{a}
\end{pmatrix}
\end{equation}

and we define the matrix product operator
\begin{equation}
\rotmat{1}{3}
=
\rotmat{1}{2}
\rotmat{2}{3}
\Rightarrow
\overline{\rotmat{1}{3}}
=
\overline{\prod}\left[ \overline{\rotmat{1}{2}}, \overline{\rotmat{2}{3}}\right]
\label{equ:matprod}
\end{equation}

and the transposition operator

\begin{equation}
\rotmat{2}{1}
=
\rotmat{1}{2}^\transp
\Rightarrow
\overline{\rotmat{2}{1}}
=
\bm{P}_\transp \overline{\rotmat{1}{2}}
\end{equation}

Then the Euler angles can be calculated from a rotation matrix with the symbol

\begin{equation}
\overline{\bm{\alpha}}(\overline{\bm{R}})
=
\bm{\alpha}(\bm{R})
\end{equation}

The gradient


\begin{align}
\frac{\partial}{\partial \bm{q}}\bm{\Phi}_{\mathrm{r}}
&=
\frac{\partial}{\partial \bm{q}} \bm{\alpha}\left(\rotmat{0}{Ex}^\transp(\bm{x}) \rotmat{0}{Eq}(\bm{q})\right) \label{equ:grad_Phi_q}\\
\bm{\Phi}_{\mathrm{r},\partial\bm{q}}
&=
\frac{\partial}{\partial \bm{q}} \overline{\bm{\alpha}}\left(\overline{\prod}\left[ \overline{\rotmat{0}{Ex}^\transp}(\bm{x}), \overline{\rotmat{0}{Eq}}(\bm{q})\right]\right) \nonumber \\
&=
\left(\frac{\partial \overline{\bm{\alpha}}}{\partial \overline{\bm{R}}}\right)
\left(\frac{\partial }{\partial \overline{\bm{R}_2}}
\overline{\prod}\left[ \overline{R_1}, \overline{R_2}\right]\right)
\left(\frac{\partial}{\partial \bm{q}} \overline{\rotmat{0}{Eq}}(\bm{q})\right)  \nonumber
\end{align}

The gradient
\begin{equation}
\bm{\Psi}_{\mathrm{r},\partial\bm{q}}
=
\begin{pmatrix} \bm{1}_{2 \times 2} & \bm{0}_{2 \times 1}\end{pmatrix} \bm{\Phi}_{\mathrm{r},\partial\bm{q}}
\end{equation}
is calculated in the same way.

$\bm{\Phi}_{\mathrm{t},\partial\bm{q}}=\bm{\Psi}_{\mathrm{t},\partial\bm{q}}$ corresponds to the translational part of the geometric Jacobian of the manipulator

The expressions from REF are sparse matrices and can be calculated efficiently via computer algebra systems as shown in appendix \ref{sec:appendix_gradient_matrix}.


\section{Resolving functional Redundancy for 3T2R Tasks}
\label{sec:ResFuncRed}


If $\mathrm{dim}(\bm{\Psi})=5$ and $\mathrm{dim}(\bm{q})>5$, which presents the typical case for solving 3T2R tasks in industry, at least one joint DoF is free for optimization additional criteria.

Example

\begin{equation}
\bm{h}
=
\frac{1}{2} (\bm{q}-\bar{\bm{q}})^\transp\bm{W}(\bm{q}-\bar{\bm{q}})
\end{equation}  
%
\begin{equation}
\bm{h}_{\partial\bm{q}}
=
\frac{\partial \bm{h}}{\partial \bm{q}}
=
\bm{W}(\bm{q}-\bar{\bm{q}})
\end{equation}

With
\begin{equation}
\bm{h}_{\partial\bm{q}}=\frac{\partial \bm{h}}{\partial \bm{q}},
\bm{\Psi}_{\partial\bm{q}}=\frac{\partial \bm{\Psi}}{\partial \bm{q}}
\end{equation}


With the gradient projection method the minimization of $\bm{h}$ in the Null space of the Jacobian $\bm{\Psi}_{\bm{q}}$ can be found

\begin{align}
\bm{\Delta}\bm{q}
&=
\bm{\Delta}\bm{q}_{\mathrm{T}} + \bm{\Delta}\bm{q}_{\mathrm{N}} \\
&=
\bm{\Psi}_{\partial\bm{q}}^{\dagger} (-\bm{\Psi}) + (\bm{1}-\bm{\Psi}_{\partial\bm{q}}^{\dagger}\bm{\Psi}_{\partial\bm{q}}) \bm{h}_{\partial\bm{q}}
\end{align}

where the Null-space incremental motion $\bm{\Delta}\bm{q}_{\mathrm{N}}$ does not influence the task achievement, which is only improved with $\bm{\Delta}\bm{q}_{\mathrm{T}}$.

\section{Application on Kinematic Constraint Equations of Parallel Robots}
\label{sec:ParRobKinConstr}

Kinematic constraint equations are used in parallel robotics to relate end-effector and joint velocities, actuator and end-effector forces or to solve the inverse kinematics problem.

Usually only the translational part of the constraint equations is defined and only the joint positions, velocities and forces associated with the translational motion are calculated. %  $\bm{q}'$

Then the position of the platform coupling point $B$ relative to the base coupling point $A$ is used:

\begin{equation}
\bm{\Phi}_{\mathrm{t}_i}(\bm{q}_i,\bm{x}) = \ortvek{0}{r}{}{A_iB_i}(\bm{q}_i) - \ortvek{0}{r}{}{A_iB_i}(\bm{x}_{\mathrm{t}})
\end{equation}
\begin{equation}
\ortvek{0}{r}{}{A_iB_i}(\bm{x}) = 
- \ortvek{0}{r}{}{0A_i}
+ \ortvek{0}{r}{}{0E}(\bm{x}_{\mathrm{t}}) + \rotmat{0}{E}(\bm{x}_{\mathrm{r}}) \ortvek{E}{r}{}{EB_i}
\end{equation}

The term $\rotmat{0}{E}(\bm{x}_{\mathrm{r}}$ depends on the full rotation description including the rotation about the tool axis.
For a formulation without the tool axis rotation a different constraint definition can be used

\begin{equation}
\bm{\Phi}_{\mathrm{t}_i}(\bm{q}_i,\bm{x}) = 
\ortvek{0}{r}{}{0E}(\bm{q}_i) - \ortvek{0}{r}{}{0E}(\bm{x}_{\mathrm{t}})
\end{equation}

where only the translational part $\bm{x}_{\mathrm{t}}$ of the end-effector coordinates occur and not the rotational part $\bm{x}_{\mathrm{r}}$.
As a drawback, all joint angles $\bm{q}_i$ of the leg $i$ are now included, not only the coordinates of the first joints.

\begin{equation}
\ortvek{0}{r}{}{0E}(\bm{q}) = 
\ortvek{0}{r}{}{0A_i}
+ \ortvek{0}{r}{}{A_iB_i}(\bm{q}_i) + \rotmat{0}{B_i}(\bm{q}_i) \ortvek{B_i}{r}{}{B_iE}
\end{equation}

To account for the increased number of included joints, also the rotational part of the kinematic constraints is needed to generate enough equations.

Here again the definition is used

\begin{align}
\bm{\Phi}_{\mathrm{r}_i}(\bm{q},\bm{x})
=\bm{\alpha}\left(\rotmat{0}{Ex}^\transp (\bm{x}_{\mathrm{r}})\rotmat{0}{Eq}(\bm{q})\right)
\end{align}

The set of constraints $\bm{\Phi}_{i}$ for each leg of the PKM can again be reduced to $\bm{\Psi}_{i}$ by removing the last rotational component, as described in Sec.\,REF.

The constraint equations for the PKM are assembled from all $m$ legs as


\begin{equation}
\bm{\Phi}
=
\begin{pmatrix}
\bm{\Phi}_1 \\
\bm{\Phi}_2 \\
\vdots \\
\bm{\Phi}_m \\
\end{pmatrix}
\end{equation}

The constraints $\bm{\Phi}$ and $\bm{\Psi}$ can be used equally.
The differential kinematics of the PKM is calculated with




\begin{equation}
\frac{\mathrm{d}}{\mathrm{d}t} \bm{\Phi}(\bm{q},\bm{x})
=
\bm{\Phi}_{\partial \bm{q}}  \dot{\bm{q}}
+
\bm{\Phi}_{\partial \bm{x}} \dot{\bm{x}}
\end{equation}
%
The diagonal elements $\bm{\Phi}_i$ of the direct kinematics Jacobian % $\bm{\Phi}_{\partial \bm{q}}$ 

\begin{equation}
\bm{\Phi}_{\partial \bm{q}}
=
\frac{\partial \bm{\Phi}}{\partial \bm{q}}
=
\begin{pmatrix}
\frac{\partial \bm{\Phi}_1}{\partial \bm{q}_1}  & 0 & 0 & 0\\
0 & \frac{\partial \bm{\Phi}_2}{\partial \bm{q}_2} & \ddots & 0  \\
0 & \ddots & \ddots & 0  \\
0 & 0 & 0 &\frac{\partial \bm{\Phi}_m}{\partial \bm{q}_m}
\end{pmatrix}
\end{equation}  

correspond to the residual vector Jacobian from Sec.\,REF.
The calculation of the inverse kinematics Jacobian

\begin{equation}
\bm{\Phi}_{\partial \bm{x}}
=
\frac{\partial \bm{\Phi}}{\partial \bm{x}}
=
\begin{pmatrix}
\frac{\partial \bm{\Phi}_1}{\partial \bm{x}}\\
\frac{\partial \bm{\Phi}_2}{\partial \bm{x}}\\
\vdots \\
\frac{\partial \bm{\Phi}_m}{\partial \bm{x}}\\
\end{pmatrix}
\end{equation}  

can be simplified similar to the process described in Sec.\,REF with

\begin{align}
\frac{\partial}{\partial \bm{x}_{\mathrm{r}}}\bm{\Phi}_{\mathrm{r}_i}
&=
\frac{\partial}{\partial \bm{x}_{\mathrm{r}}} \bm{\alpha}\left((\rotmat{0}{Eq}^\transp(\bm{q}) \rotmat{0}{Ex}(\bm{x}_{\mathrm{r}}))^\transp\right) (\label{equ:grad_Phi_x}) \\
\bm{\Phi}_{\mathrm{r}_i,\partial \bm{x}_{\mathrm{r}}} 
&=
\frac{\partial}{\partial \bm{x}_{\mathrm{r}}} \overline{\bm{\alpha}}\left(
\bm{P}_{\mathrm{T}}
\overline{\prod}\left[ \overline{\rotmat{0}{Eq}^\transp}(\bm{q}), \overline{\rotmat{0}{Ex}}(\bm{x}_{\mathrm{r}})\right]\right) \nonumber \\
&=
\left(\frac{\partial \overline{\bm{\alpha}}}{\partial \overline{\bm{R}}}\right)
\bm{P}_{\mathrm{T}}
\left(\frac{\partial }{\partial \overline{\bm{R}_2}}
\overline{\prod}\left[ \overline{R_1}, \overline{R_2}\right]\right)
\left(\frac{\partial}{\partial \bm{x}_{\mathrm{r}}} \overline{\rotmat{0}{Ex}}(\bm{x}_{\mathrm{r}})\right) \nonumber
\end{align}





\section{Simulative Evaluation for solving Serial Robot inverse Kinematics in 3T2R Tasks}
\label{sec:SimEvalSerRobIK}

\section{Conclusions}
\label{sec:Conclusion}

\section{APPENDIX}

\subsection{Influence of Reciprocal Euler angles}
\label{sec:appendix_eulerreciproc}

This section derives the effect of the reciprocity of Euler-angles at the example of the kinematics description of Sec.\,\ref{sec:RecEulAng} and the frames of Fig.\,\ref{fig:frames_6dof}.

An end-effector orientation $\bm{\beta}=\bm{x}_{\mathrm{r}}$ gives the rotation matrix from\footnote{The matrix rotates vectors from $\ks{Eq}$ to $\ks{Ex}$} the actual end-effector frame $\ks{Eq}$ to the desired frame end-effector $\ks{Ex}$
%
\begin{equation}
\rotmat{Ex}{Eq}(\bm{\beta},\bm{q})
= 
\rotmat{0}{Ex}^\transp (\bm{\beta})\rotmat{0}{Eq}(\bm{q})
\end{equation}
%
where with the Euler-X-Y-Z-angles we have
%
\begin{equation}
\rotmat{0}{Ex}^\transp(\bm{\beta})
=
\bm{R}_z(-\beta_3) \bm{R}_y(-\beta_2) \bm{R}_x(-\beta_1)
\end{equation}
%
as introduced in (\ref{equ:def_rmat_xyz}).
With an additional rotation $\delta$ around the $z$-axis for the desired orientation, we have the new Euler angles
%
\begin{equation}
\beta_1'=\beta_1,  \quad \beta_2'=\beta_2,  \quad \beta_3'=\beta_3-\delta.
\end{equation}
%
The additional rotation corresponds to the tool axis defined in Sec.\,\ref{sec:RecEulAng} % and does not influence 3T2R tasks.
and leads to a new residual orientation error expressed as a rotation matrix
%
\begin{align}
\rotmat{Ex}{Eq}(\bm{\beta}',\bm{q})
&=
\rotmat{0}{Ex}^\transp (\bm{\beta}') \rotmat{0}{Eq}(\bm{q}) \nonumber\\
&=
\left(\rotmat{0}{Ex}(\bm{\beta})\bm{R}_z(-\delta)\right)^\transp \rotmat{0}{Eq}(\bm{q}) \nonumber \\
&=
\bm{R}_z(\delta) \rotmat{0}{Ex}^\transp (\bm{\beta}) \rotmat{0}{Eq}(\bm{q}) \nonumber \\
&=
\bm{R}_z(\delta) \rotmat{Ex}{Eq}(\bm{\beta},\bm{q}).
\end{align}

We define the first residual orientation error corresponding to $\bm{\beta}$ as a rotation matrix
%
\begin{align}
\rotmat{Ex}{Eq}(\bm{\beta},\bm{q})
=\left[ \begin {array}{ccc} {n_x}&{o_x}&{a_x} \\ \noalign{\medskip}{n_y}&{o_y}&{a_y}\\ \noalign{\medskip}{ n_z}&{o_z}&{a_z}\end {array} \right] 
\end{align}
%
and as an Z-Y-X-Euler angle representation around fixed frames
%
\begin{align}
\bm{\alpha} =
\left[ \begin {array}{c} \arctan \left( {o_z},{a_z} \right)  \\ \noalign{\medskip}\arctan \left( -{n_z},\sqrt {{{a_z}}^{2}+{{ o_z}}^{2}} \right) \\ \noalign{\medskip}\arctan \left( {n_y},{ n_x} \right) \end {array} \right].
\label{equ:alpha_xyz}
\end{align}

The error corresponding to $\bm{\beta}'$ only differs regarding the additional rotation $\delta$ with
%
\begin{align}
&\rotmat{Ex}{Eq}(\bm{\beta}',\bm{q})
= \\
&\left[ \begin {array}{ccc} { C_{\delta}}\,{n_x}-{ S_{\delta}}\,{ n_y}&{ C_{\delta}}\,{o_x}-{ S_{\delta}}\,{o_y}&{ C_{\delta}}\,{ a_x}-{ S_{\delta}}\,{a_y}\\ \noalign{\medskip}{ C_{\delta}}\,{n_y}+ { S_{\delta}}\,{n_x}&{ C_{\delta}}\,{o_y}+{ S_{\delta}}\,{o_x}&{  C_{\delta}}\,{a_y}+{ S_{\delta}}\,{a_x}\\ \noalign{\medskip}{ n_z}&{o_z}&{a_z}\end {array} \right] \nonumber
\end{align}
%
where $C_{\delta}=\mathrm{cos}(\delta)$, $S_{\delta}=\mathrm{sin}(\delta)$.
The Z-Y-X-Euler angles regarding fixed frames from this rotation matrix are
%
\begin{equation}
\bm{\alpha}' =
 \left[ \begin {array}{c} \arctan \left( {o_z},{a_z} \right)  \\
  \noalign{\medskip}\arctan \left( -{n_z},\sqrt {{{a_z}}^{2}+{{ o_z}}^{2}} \right) \\
  \noalign{\medskip}\arctan \left( {  C_{\delta}}\,{n_y}+{ S_{\delta}}\,{n_x},{ C_{\delta}}\,{n_x}-{  S_{\delta}}\,{n_y} \right) \end {array} \right] 
\end{equation}
%
where $\delta$  only influences the components $\alpha_1$ and $\alpha_2$.
This allows the conclusion, that $\beta_3$only influences $\alpha_3$ and results in the dependencies
%
\begin{align}
\alpha_1'&=\alpha_1'(\bm{q},\beta_1,\beta_2) =\alpha_1\\
\alpha_2'&=\alpha_2'(\bm{q},\beta_1,\beta_2) =\alpha_2\\
\alpha_3'&=\alpha_3'(\bm{q},\beta_1,\beta_2,\beta_3)
\end{align}
%
already displayed in (\ref{equ:alpha1_dep_beta})-(\ref{equ:alpha3_dep_beta}) with the consequences for the kinematic modeling of robots in 3T2R tasks described in Sec.\,\ref{sec:RecEulAng_effect}.

\subsection{Matrix Operations for Partial Derivatives}
\label{sec:appendix_gradient_matrix}

The single expressions derived in Sec.\,\ref{sec:RecEulAng_implement} for the serial chains and in Sec.\,xx for the parallel chains can be calculated with low computational effort from the definition of the X-Y-Z- and Z-Y-X-Euler angles from (\ref{equ:def_rmat_xyz}), (\ref{equ:def_rmat_zyxr}) and (\ref{equ:alpha_xyz}).

The gradient in (\ref{equ:grad_Phi_q}) becomes
%
\begin{equation}
\left(\frac{\partial \overline{\bm{\alpha}}}{\partial \overline{\bm{R}}}\right)^\transp
=
 \left[ \begin {array}{ccc} -{\frac {{n_y}}{{{n_x}}^{2}+{{n_y }}^{2}}}&0&0\\ \noalign{\medskip}{\frac {{n_x}}{{{n_x}}^{2}+{{ n_y}}^{2}}}&0&0\\ \noalign{\medskip}0&-\sqrt {{{a_z}}^{2}+{{ o_z}}^{2}}&0\\ \noalign{\medskip}0&0&0\\ \noalign{\medskip}0&0&0 \\ \noalign{\medskip}0&{\frac {{n_z}\,{o_z}}{\sqrt {{{a_z}}^{ 2}+{{o_z}}^{2}}}}&{\frac {{a_z}}{{{a_z}}^{2}+{{o_z}}^{2}}} \\ \noalign{\medskip}0&0&0\\ \noalign{\medskip}0&0&0 \\ \noalign{\medskip}0&{\frac {{n_z}\,{a_z}}{\sqrt {a_z^{2}+{{o_z}}^{2}}}}&-{\frac {o_z}{a_z^{2}+o_z^{2}} }\end {array} \right] 
\end{equation}
%
and the inverse gradient in (\ref{equ:grad_Phi_x}) yields
%
\begin{align}
&\left(\frac{\partial \overline{\bm{R}}(\bm{\beta})}{\partial \overline{\bm{\beta}}}\right)
=\\
\small
&\begin{bmatrix}
0&-{ S_2}\,{ C_3}&-{ C_2}\,{ S_3}
\\ { C_1}\,{ S_2}\,{ C_3}-{ S_1}\,{ S_3}&{
    S_1}\,{ C_2}\,{ C_3}&-{ S_1}\,{ S_2}\,{ S_3}+{ C_1}\,{
    C_3}\\ { S_1}\,{ S_2}\,{ C_3}+{ C_1}\,{
    S_3}&-{ C_1}\,{ C_2}\,{ C_3}&{ C_1}\,{ S_2}\,{ S_3}+{
    S_1}\,{ C_3}\\ 0&{ S_2}\,{ S_3}&-{ C_2}\,
{ C_3}\\ -{ C_1}\,{ S_2}\,{ S_3}-{ S_1}\,{
    C_3}&-{ S_1}\,{ C_2}\,{ S_3}&-{ S_1}\,{ S_2}\,{ C_3}-{
    C_1}\,{ S_3}\\ -{ S_1}\,{ S_2}\,{ S_3}+{
    C_1}\,{ C_3}&{ C_1}\,{ C_2}\,{ S_3}&{ C_1}\,{ S_2}\,{
    C_3}-{ S_1}\,{ S_3}\\ 0&{ C_2}&0
\\ -{ C_1}\,{ C_2}&{ S_1}\,{ S_2}&0
\\ -{ S_1}\,{ C_2}&-{ C_1}\,{ S_2}&0
\end {bmatrix}  \nonumber
\end{align}
%
with $C_i=\mathrm{cos}(\beta_i)$, $S_i=\mathrm{sin}(\beta_i)$.
The gradient of the matrix product (\ref{equ:matprod}) in (\ref{equ:grad_Phi_x}) and (\ref{equ:grad_Phi_q}) is
\begin{equation}
\left(\frac{\partial }{\partial \overline{\bm{R}_2}}
\overline{\prod}\left[ \overline{R_1}, \overline{R_2}\right]\right)
=
\begin{pmatrix}
\bm{R}_1 & \bm{0} & \bm{0} \\
\bm{0} & \bm{R}_1 & \bm{0} \\
\bm{0} & \bm{0} & \bm{R}_1  \\
\end{pmatrix}
\end{equation}



\section{Acknowledgements}

The financial support from the Deutsche Forschungsgemeinschaft (German Research Foundation, DFG) under grant 341489206 are gracefully acknowledged.

% BIBLIOGRAPHY
\bibliographystyle{ieeetr}
\bibliography{ikfr_ref}

\end{document}
