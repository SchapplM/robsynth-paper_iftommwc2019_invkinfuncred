\documentclass[twocolumn,10pt]{IFTOMM}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{calrsfs} % Für Kalligraphie-F 
\newcommand{\bm}[1]{\boldsymbol{#1}}

% Latex-Makros für häufig verwendete Formelzeichen
\newcommand{\ortvek}[4]{{ }_{(#1)}{\boldsymbol{#2}}^{#3}_{#4} }
\newcommand{\vek}[3]{\boldsymbol{#1}^{#2}_{#3}}
\newcommand{\rotmat}[2]{{{ }^{#1}\boldsymbol{R}}_{#2}}
\newcommand{\rotmato}[2]{{{ }^{#1}\boldsymbol{\overline{R}}}_{#2}}
\newcommand{\transp}[0]{{\mathrm{T}}}
\newcommand{\ks}[1]{{\mathcal{F}}_{#1}}

% Für Deutsche Umlaute
\usepackage{ngerman}
\usepackage[utf8]{inputenc}

% Für Bilder
\usepackage{graphicx}
\usepackage{color}
\graphicspath{{./figures/}}

\begin{document}
%PAPER NUMBER: will be provided by the organization for accepted paper
\def\papernumber{IK xxx}
\def\conference_name{15th IFToMM World Congress, Krakow, Poland, 30 June--4 July, 2019}
%PAPER TITLE
\title{Resolution of Functional Redundancy for 3T2R Robot Tasks  \\ using Two Sets of Reciprocal Euler Angles}

\author{
    \begin{tabular}{cccc}
    M.\ Schappler\thanks{moritz.schappler@imes.uni-hannover.de}
& S.\ Tappe\thanks{svenja.tappe@imes.uni-hannover.de}
& T.\ Ortmaier\thanks{tobias.ortmaier@imes.uni-hannover.de}\\
    \multicolumn{3}{c}{Institute for Mechatronic Systems} \\
    \multicolumn{3}{c}{Leibniz University Hannover, Hannover, Germany}
    \end{tabular}
}

%ESSENTIAL, will not work otherwise
\maketitle

%ABSTRACT
\begin{abstract}
Robotic tasks like welding or drilling with three translational and only two rotational degrees of freedom (``3T2R'') are of high industrial relevance but are ra\-ther scarcely addressed in scientific publications.
Existing solutions for the resolution of the functional redundancy of robotic manipulators performing these tasks either expand the full kinematic formulation or reduce it in intermediate steps.
This paper presents an approach to reduce the kinematic formulation from the start to solve the problem in a simpler way.
This is done by using a set of reciprocal Euler angles to describe the end-effector orientation and the orientation error in inverse kinematics.
\end{abstract}

%KEYWORDS
\begin{keywords}
functional redundancy, redundancy resolution, reciprocal Euler angles, inverse kinematics, robots, five-DoF task, 3T2R task
\end{keywords}

\section{Introduction}
\label{sec:Intro}
Since the first papers in the 1980s, the fields of inverse kinematics \cite{GoldenbergBenFen1985} and the resolution of \emph{intrinsic} redundancy \cite{Yoshikawa1984} in robotics have been extensively elaborated upon.
Inverse kinematics for robot manipulators can be solved analytically for some structures and can be approached in general with gradient-based numeric methods at  joint position or joint velocity level.
Due to the nonlinearity of rotation at position level \cite{GoldenbergBenFen1985}, the latter is usually preferred.

The kinematics of \emph{functionally} redundant robots performing tasks with five instead of six degrees of freedom (DoF) has drawn much less attention, even if many industrial relevant tasks only require 5-DoF such as the class of 3T2R-tasks where the tool for the task is axis-symmetric.
These tasks comprise amongst others arc welding \cite{HuoBar2005}, drilling \cite{ZhuQuCaoYan2013,GuoDonKe2015}, spray-painting \cite{FromGra2010}, laser-cutting, milling and glueing and are transfered to a greater extend to robotic manipulators in the automotive or aviation industry.

Since standard industrial robots have six DoF, one degree of \emph{functional} redundancy exists which allows to improve performance characteristics of the robots while achieving a valid pose to perform one of the aforementioned tasks.
To be able to incorporate performance optimization into inverse kinematics via the well-established gradient projection method \cite{Yoshikawa1984}, either the joint space can be augmented or the task space can be reduced \cite{Huo2009}.
Augmenting the joint space is possible by inserting an additional joint for the rotation around the task's axis of symmetry (``tool axis'') \cite{Baron2000}.
Reducing the task space can be performed by orthogonal decomposition of the end-effector twist \cite{HuoBar2005}, removing the row of the ``task frame Jacobian'' corresponding to the tool axis \cite{Zlajpah2017}, the construction of the Jacobian Nullspace based upon geometric properties of the task \cite{LegerAng2016} or constructing a cone or pyramid resulting from the tool axis with an additional range of tolerance for tilt angles \cite{FromGra2010}.

Another possibility for the resolution of the functional redundancy is a cascaded optimization where the inner loop calculates the inverse kinematics with standard methods and the outer loop optimizes the performance index.
The optimization can be performed by evaluating the index on a range of rotation angles around the tool axis \cite{ZhuQuCaoYan2013} or by using the incremental change of the rotation around the tool axis directly to adapt the joint angles  \cite{GuoDonKe2015}.

The choice of performance indices aims to improve the task execution with measures such as the joint positions quadratic \cite{HuoBar2005} or hyperbolic \cite{ZhuQuCaoYan2013} distances from their limits, singularity avoidance via Frobenius-norm condition number \cite{ZhuQuCaoYan2013}, squared condition number \cite{LegerAng2016} or a combination of manipulability and condition number of the Jacobian \cite{HuoBar2008} or stiffness \cite{GuoDonKe2015}.

The characteristic length required to normalize the Jacobian for the performance indices can be either chosen constant regarding the robot geometry \cite{ZhuQuCaoYan2013} or as an additional optimization parameter \cite{LegerAng2016}.

The existing methods each have drawbacks that are avoided by using the new method presented in this paper:
\begin{itemize}
    \item Augmenting the joint space \cite{Baron2000} increases the computational cost and can lead to an ill-conditioned Jacobian \cite{HuoBar2008}.
    \item Using a nested optimization \cite{ZhuQuCaoYan2013,GuoDonKe2015} does not allow using the well-proven gradient projection method.
    \item In \cite{Zlajpah2017} the tool-axis rotation of the end-effector has to be calculated and canceled out in the nullspace.
    \item Describing the tool axis with two points requires to define a distance between these points, which has to be chosen e.\,g. as the normalized Jacobian's characteristic length to gain a good conditioning of the optimization problem \cite{LegerAng2016}.
    \item All methods have a high mathematical level of abstraction e.\,g. using orthogonal decomposition \cite{HuoBar2008}, linear matrix inequalities and convex optimization \cite{FromGra2010}, rotation and component-selection of the vector part of the quaternion orientation error \cite{Zlajpah2017} or sequential quadratic programming \cite{LegerAng2016}.
\end{itemize}

This paper transfers the velocity level approach from \cite{Zlajpah2017} to the position level and the orientation error is expressed in Euler angles instead of quaternions:
%
The absolute orientation of the end-effector and the corresponding orientation error between desired and actual end-effector orientation are expressed with two sets of Euler angles which are mutually reciprocal.
Reciprocity for sets of Euler angles is defined in this paper as successive rotations around intrinsic elementary axes of switched order.
By this definition, the rotation component belonging to the tool axis in 3T2R tasks is always the same for the absolute orientation and for the orientation error, respectively.
The effect of the tool axis can then be eliminated from the kinematic equations.
This allows to express the kinematics equations in minimal form which makes it easy to use the gradient projection method to incorporate performance indices in inverse kinematics.

The contributions of this paper are
\begin{itemize}
    \item a new formulation for the kinematics problem for robot manipulators performing 3T2R-tasks,
    \item an application of the formulation leading to an efficient solution for inverse kinematics with functional redundancy,
    \item remarks on the implementation of gradients of and w.r.t. rotation matrices and its performance,
    \item the extension of the formalism on parallel robots.
\end{itemize}

The remainder of the paper is structured as follows: The idea of a kinematics description using sets of reciprocal Euler angles is elaborated upon in Sec.\, \ref{sec:RecEulAng}.
Their application in resolving the functional redundancy in inverse kinematics of 3T2R tasks is shown in Sec.\,\ref{sec:ResFuncRed}.
Sec.\,\ref{sec:ParRobKinConstr} gives an outlook on the definition of kinematic constraints for parallel robots. 
Sec.\,\ref{sec:Conclusion} concludes the paper.

\section{Using reciprocal Euler Angles for Robot Kinematics}
\label{sec:RecEulAng}

The core of solving the inverse kinematics problem of robot manipulators for tasks with only two rotational degrees of freedom is the nonlinearity of rotation.
Rotation can be described using rotation matrices, Euler angles, rotation angle/axis and its derivations like quaternions or the Rodrigues vector.
In contrast to all other notations, consecutive elementary rotations like Euler angles can be reduced to adapt for tasks only requiring two rotatory DoF.

\subsection{Kinematics Description}
\label{sec:RecEulAng_KinDesc}

A serial kinematic chain is described with the joint positions $\bm{q}$ and the forward kinematics
%
\begin{equation}
\bm{x} (\bm{q})
=
\bm{f} (\bm{q})
\label{equ:dirkin}
\end{equation}
%
giving the position and orientation of the actual end-effector frame $\ks{E}$.
The general pose of the robot end-effector
%
\begin{equation}
\bm{x}
=
\begin{bmatrix}
\bm{x}_{\mathrm{t}}^\transp & \bm{x}_{\mathrm{r}}^\transp
\end{bmatrix}^\transp
\label{equ:x_def}
\end{equation}
%
describes the robot end-effector frames $\ks{D}$ position 
%
\begin{equation}
\bm{x}_{\mathrm{t}}
=
\ortvek{0}{r}{}{D}
\label{equ:xt_def}
\end{equation}  
%
and orientation 
%
\begin{equation}
\rotmat{0}{D} (\bm{x}_{\mathrm{r}})
=
\begin{bmatrix}\vek{n}{}{D} & \vek{o}{}{D} & \vek{a}{}{D}\end{bmatrix}
\label{equ:xr_def_rotmat}
\end{equation}  
% 
with respect to the base frame $\ks{0}$ expressed without loss of generality with a set $\bm{\beta}$ of $X$-$Y$-$Z$-Euler angles\footnote{other sets of Euler angles with the same properties may be used as well}
%
\begin{equation}
\bm{x}_{\mathrm{r}}
=
\begin{bmatrix}
\beta_1  & \beta_2 & \beta_3
\end{bmatrix}^{\mathrm{T}},
\label{equ:xr_def}
\end{equation} 
%
\begin{equation}
\bm{R}(\bm{\beta}) = \bm{R}_x(\beta_1) \bm{R}_y(\beta_2) \bm{R}_z(\beta_3) \in \mathrm{SO(3)}.
\label{equ:def_rmat_xyz}
\end{equation}
%
In the following, the general pose $\bm{x}$ of the robot end-effector is regarded independent of the forward kinematics $\bm{f}(\bm{q})$ in (\ref{equ:dirkin}).
If the general pose is identical to the actual pose, the frames $\ks{D}$ and $\ks{E}$ are identical.
The general pose is the \emph{desired} (``D'') end-effector pose in the inverse kinematics problem and will be termed with ``$\bm{x}$'' without further supplements for the sake of compactness of the equations.
The deviation $\bm{\Phi}$ between the desired end-effector frame $\ks{D}$ expressed with $\bm{x}$ and the actual robots end-effector frame $\ks{E}$ expressed with $\bm{f}(\bm{q})$ is defined as
%
\begin{equation}
\bm{\Phi}=\begin{bmatrix}
\bm{\Phi}_{\mathrm{t}}^\transp & \bm{\Phi}_{\mathrm{r}}^\transp
\end{bmatrix}^\transp \in {\mathbb{R}}^{6}.
\label{equ:Phi_def}
\end{equation}
%
The vector from $\ks{D}$ to $\ks{E}$ is the translational part 
%
\begin{equation}
\bm{\Phi}_{\mathrm{t}}(\bm{q},\bm{x}) = - \bm{x}_{\mathrm{t}} + \ortvek{0}{r}{}{E}(\bm{q}) \in {\mathbb{R}}^{3}
\label{equ:Phit_def}
\end{equation}
%
and the rotational part
%
\begin{align}
\bm{\Phi}_{\mathrm{r}}(\bm{q},\bm{x}) &= \begin{bmatrix}
\alpha_1  & \alpha_2 & \alpha_3
\end{bmatrix}^\transp
=\bm{\alpha}\left(\rotmat{D}{E}\right)\nonumber \\
&=\bm{\alpha}\left(\rotmat{0}{D}^\transp (\bm{x}_{\mathrm{r}})\rotmat{0}{E}(\bm{q})\right) \in {\mathbb{R}}^{3}
\label{equ:Phir_def}
\end{align}
%
of this ``residual vector'' is also chosen as a set of Euler angles $\bm{\alpha}$ \cite{GoldenbergBenFen1985}, that is calculated from the rotation matrices.
The Euler angle convention of the residual $\bm{\alpha}$ can be chosen independently of the choice for the orientation representation in  $\bm{x}_{\mathrm{r}}$.
The intuitive approach of choosing
%
\begin{equation}
\bm{R}(\bm{\alpha}^*) := \bm{R}_x(\alpha_1^*) \bm{R}_y(\alpha_2^*) \bm{R}_z(\alpha_3^*) \in \mathrm{SO(3)}
\label{equ:alpha_convention_xyz}
\end{equation}
%
the same way as $\bm{\beta}$ leads to a set of transformations depicted in Fig.\,\ref{fig:frames_6dof} where the intermediate steps of the single elementary rotations are omitted since they have no technical meaning.
%
\begin{figure}[tb]
    \input{./figures/frame_comparison_6dof.pdf_tex}
    \vspace{-0.2cm}
    \caption{Overview of the different frames for 6-dof tasks with standard Euler-angle notation.}
    \label{fig:frames_6dof}
\end{figure} 

\subsection{Effect of the reciprocal Euler Angles}
\label{sec:RecEulAng_effect}

\begin{figure}[htb]
    \input{./figures/frame_comparison_5dof.pdf_tex}
    \caption{overview of the different frames for 5-dof tasks with reciprocal Euler-angle notation.}
    \label{fig:frames_5dof}
\end{figure} 

Using $\bm{\alpha}$ as defined in the previous subsection\,\ref{sec:RecEulAng_KinDesc}, all three components of $\bm{x}_{\mathrm{r}}=\bm{\beta}$ affect the rotation matrix $\rotmat{D}{E}$, which makes it impossible to remove one rotational coordinate from the kinematic description, even if it is not required.
%
To encounter this issue, the Euler angle convention $\bm{\alpha}$ for the orientation error is now chosen to be 
%
\begin{equation}
\bm{R}(\bm{\alpha}) := \bm{R}_z(\alpha_1) \bm{R}_y(\alpha_2) \bm{R}_x(\alpha_3) \in \mathrm{SO(3)}
\label{equ:def_rmat_zyxr}
\end{equation}
%
instead of the definition from (\ref{equ:alpha_convention_xyz}).
This set of $Z$-$Y$-$X$-Euler angles $\bm{\alpha}$ is defined in this paper as being \emph{reciprocal} to the $X$-$Y$-$Z$-convention of $\bm{\beta}$ for the absolute orientation.
%
The reciprocity only refers to the switched order of the elementary axes $X$, $Y$ and $Z$.
Since $\bm{\alpha}$ and $\bm{\beta}$ describe different rotation matrices, the respective intermediate rotation axes are different.

% from (\ref{equ:xt_def}),(\ref{equ:xr_def})
Similar to the end-effector operational space coordinates $\bm{x}$ the task space is defined to have the coordinates
%
\begin{equation}
\bm{\eta}
=
\begin{bmatrix}
\bm{\eta}_{\mathrm{t}}^\transp & 
\bm{\eta}_{\mathrm{r}}^\transp
\end{bmatrix}^\transp
\end{equation}  
%
with the unchanged translational part
%
\begin{equation}
\bm{\eta}_{\mathrm{t}}
=
\bm{x}_{\mathrm{t}}
=
\ortvek{0}{r}{}{D}
\end{equation}  
%
compared to $\bm{x}$ and the modified rotational part
%
\begin{equation}
\bm{\eta}_{\mathrm{r}}
=
\begin{bmatrix}
\beta_1  & \beta_2
\end{bmatrix}^\transp
=
\underbrace{\begin{bmatrix}
1 & 0 & 0  \\ 
0 & 1 & 0
\end{bmatrix}}_{=\bm{P}_{\eta}}
\bm{x}_{\mathrm{r}}
\label{equ:etar_def}
\end{equation}
%
where the last rotation $\beta_3$ around the $z$-axis $\bm{a}_{D}$ of $\rotmat{0}{D}$ is not included since it corresponds to a rotation around the tool axis in 3T2R tasks and is a degree of freedom which can be set arbitrarily.

Distinguishing the frames $\ks{A1}$ and $\ks{A2}$ resulting from intermediate elementary rotations, sketched in Fig.\,\ref{fig:frames_5dof}, gives the partial frame rotation to the desired frame
%
\begin{align}
\rotmat{0}{A1} 
&= 
\bm{R}_x(\beta_1) \bm{R}_y(\beta_2)\\
&=
\begin{bmatrix}
\vek{n}{}{A1} & \vek{o}{}{A1} & \vek{a}{}{A1}
\end{bmatrix} \nonumber
\end{align}
%
and the partial frame rotation
%
\begin{align}
\rotmat{0}{A2} 
&= 
\rotmat{0}{E}(\bm{q})
\left(\bm{R}_x(\alpha_3) \bm{R}_y(\alpha_2)\right)^\transp \\ 
&=
\begin{bmatrix}
\vek{n}{}{A2} & \vek{o}{}{A2} & \vek{a}{}{A2}
\end{bmatrix}\nonumber
\end{align}
%
from the actual frame and the $x$- and $y$-axis error components.

The frames $\ks{A1}$, $\ks{A2}$ and $\ks{D}$ all share the same $z$-axis
%
\begin{equation}
\vek{a}{}{D}
=
\vek{a}{}{A1}
=
\vek{a}{}{A2}
\label{equ:z_axis_equal}
\end{equation}
%
which is also the tool axis, since transformations between these frames are rotations $\bm{R}_z$ around the $z$-axes from (\ref{equ:z_axis_equal}).

Since the tool axis rotation $\beta_3$ and the orientation error component $\alpha_1$ are defined around the same axis, $\beta_3$ only influences $\alpha_1$ and not $\alpha_2$ and $\alpha_3$, as derived in the appendix \ref{sec:appendix_eulerreciproc}, which can be expressed by
%
\begin{align}
\begin{bmatrix}
\alpha_1 \\
\alpha_2 \\
\alpha_3
\end{bmatrix}
=
\begin{bmatrix}
\alpha_1(\bm{q},\beta_1,\beta_2,\beta_3) \\
\alpha_2(\bm{q},\beta_1,\beta_2) \\
\alpha_3(\bm{q},\beta_1,\beta_2)
\end{bmatrix}
=
\begin{bmatrix}
\alpha_1(\bm{q},\bm{x}) \\
\alpha_2(\bm{q},\bm{\eta}) \\
\alpha_3(\bm{q},\bm{\eta}) 
\end{bmatrix}
\label{equ:alpha_dep_beta}.
\end{align}
%
This property of the reciprocal Euler angles allows a kinematic description of robots in 3T2R tasks, as elaborated in the next sections.

\subsection{Application on 3T2R Tasks}
\label{sec:RecEulAng_3T2R_app}

The standard methods introduced in Sec.\,\ref{sec:Intro} for solving the inverse kinematics for 3T2R tasks and exploiting the functional redundancy struggle with the definition of a Jacobian matrix with appropriate dimensions.
To obtain a Jacobian with minimal row dimension the kinematic condition for the 3T2R problem in the coordinates $\bm{\eta}$ is now described as
%
\begin{equation}
\bm{\Psi}=\begin{bmatrix}
\bm{\Psi}_{\mathrm{t}} & \bm{\Psi}_{\mathrm{r}}
\end{bmatrix}^\transp \in {\mathbb{R}}^{5}
\end{equation}
%
following the definition for $\bm{\Phi}$ from (\ref{equ:Phi_def}) with the translational part
%
\begin{equation}
\bm{\Psi}_{\mathrm{t}}(\bm{q},\bm{\eta}) 
= 
\bm{\Phi}_{\mathrm{t}}(\bm{q},\bm{x}) 
=
- \bm{\eta}_{\mathrm{t}} + \ortvek{0}{r}{}{E}(\bm{q}) \in {\mathbb{R}}^{3}
\end{equation}
%
equal to (\ref{equ:Phit_def}) and the adapted rotational part
%
\begin{align}
\bm{\Psi}_{\mathrm{r}}(\bm{q},\bm{\eta}) &= 
\begin{bmatrix}
\alpha_2  & \alpha_3
\end{bmatrix}^\transp \nonumber \\
&=
\underbrace{\begin{bmatrix}
    0 & 1 & 0  \\ 
    0 & 0 & 1
    \end{bmatrix}}_{=\bm{P}_{\Psi}}
 \bm{\Phi} (\bm{q},\bm{x})
\label{equ:Psir_def}
\end{align}
%
from (\ref{equ:Phir_def}). 
The dependence on $\bm{\eta}$ and not on $\bm{x}$ can be explained by using (\ref{equ:alpha_dep_beta}) and (\ref{equ:etar_def}) which results to
%
\begin{equation}
\bm{\Psi}_{\mathrm{r}}(\bm{q},\bm{\eta}) = \bm{P}_{\Psi} \bm{\alpha}\left(\rotmat{0}{A1}^\transp (\bm{\eta}_{\mathrm{r}})\rotmat{0}{E}(\bm{q})\right) \in {\mathbb{R}}^{2}.
\end{equation}


The condition $\bm{\Phi}=\bm{0}$ or $\bm{\Psi}=\bm{0}$ leads to a valid configuration of the end-effector position and the complete orientation of the end-effector (using $\bm{\Phi}$) or the orientation only of the tool-axis (using $\bm{\Psi}$).
Following \cite{GoldenbergBenFen1985}, the inverse kinematics problem for serial link robots with 6-DoF at the iterative step $k+1$ can be derived with the Taylor series expansion of $\bm{\Phi}(\bm{q},\bm{x})$ to
%
\begin{equation}
\bm{\Phi}(\bm{q}^{k+1},\bm{x}) = 
\bm{\Phi}(\bm{q}^{k},\bm{x})
+
\frac{\partial}{\partial \bm{q}} \bm{\Phi}(\bm{q},\bm{x}) \biggr\rvert_{\bm{q}^k} (\bm{q}^{k+1} - \bm{q}^k)
\label{equ:taylor_phi}
\end{equation}
%
where $\bm{\Phi}_{\partial\bm{q}}=(\partial \bm{\Phi} / \partial \bm{q})$ is called the ``Jacobian matrix corresponding to the residual vector'' ($\bm{\Phi}$) in \cite{GoldenbergBenFen1985}.

For 3T2R tasks
%
\begin{equation}
\bm{\Psi}(\bm{q}^{k+1},\bm{\eta}) = 
\bm{\Psi}(\bm{q}^{k},\bm{\eta})
+
\frac{\partial}{\partial \bm{q}} \bm{\Psi}(\bm{q},\bm{\eta}) \biggr\rvert_{\bm{q}^k} (\bm{q}^{k+1} - \bm{q}^k)
\label{equ:taylor_psi}
\end{equation}
%
can be defined in the same way with the condition
%
\begin{equation}
\bm{\Psi}(\bm{q}^{k+1},\bm{\eta})=\bm{0}
\end{equation}
%
for solution of the inverse kinematics in the next step $k+1$. The increment 
%
\begin{equation}
\Delta \bm{q}^k
=
\left(\frac{\partial \bm{\Psi}(\bm{q},\bm{x})}{\partial \bm{q}}\biggr\rvert_{\bm{q}^k}\right)^{\dagger}
(\bm{0} - \bm{\Psi}(\bm{q}^{k},\bm{\eta}))
\label{equ:deltaq_psi}
\end{equation}
%
of the joint angles towards this solution can be used in iterative algorithms well-known in robotics literature like Newton-Raphson.
Depending on the dimension of the matrix, $(\cdot)^\dagger$ denotes the matrix inverse or the pseudo-inverse.

\subsection{Discussion of Singularities}

In \cite{Zlajpah2017} quaternions were used in favor of Euler angles for the orientation error with the reasons that a singularity-free representation of $\bm{\Phi}=\bm{0}$ is needed.
This is the case for Tait-Bryan angles\footnote{$A$-$B$-$C$-Euler angles with axes $A \ne C$ as opposed to ``proper Euler angles'' with $A = C$. The elementary axes are $A,B,C \in \{ X,Y,Z\}$.} like e.\,g. the $Z$-$Y$-$X$ notation used here for $\bm{\alpha}$.
For control purposes it can be assumed that the components of the orientation error $\bm{\alpha}$ always stay below 90$^\circ$, which avoids the ``gimbal lock'' representation singularity of Euler angles.
This assumption can be justified by the consideration that active and effective position and orientation tracking will only produce small errors.
A singularity-free representation of the absolute orientation $\bm{\beta}$ has to be ensured at the phase of motion planning, as well as avoiding discontinuities of the trajectory.

\subsection{Remarks on the Implementation}
\label{sec:RecEulAng_implement}

The Jacobians $\bm{\Phi}_{\partial\bm{q}}$ of (\ref{equ:taylor_phi}) or $\bm{\Psi}_{\partial\bm{q}}$ of (\ref{equ:taylor_psi}) consist of nested non-linear functions and do not use the geometric Jacobian of the serial link manipulator for the rotational part, which is easy to calculate. 
%
However, $\bm{\Phi}_{\partial\bm{q}}$ can be implemented efficiently by exploiting the chain rule and sparsity of the matrices with partial derivatives as shown in the following.

The column operator $\overline{\bm{R}}$ for matrices is defined with
%
\begin{equation}
\overline{\bm{R}}(\bm{R})=\begin{bmatrix}
\bm{n} \\ \bm{o} \\ \bm{a}
\end{bmatrix} \in {\mathbb{R}}^{9}
\quad
\mathrm{with}
\quad
\bm{R}=\begin{bmatrix}
\bm{n} & \bm{o} & \bm{a}
\end{bmatrix}
 \in {\mathbb{R}}^{3 \times 3}
\end{equation}
%
to avoid differentiating matrices or w.r.t. matrices.
Matrix multiplication is then expressed with the product operator
%
\begin{equation}
\overline{\Pi}: {\mathbb{R}}^{9} \times {\mathbb{R}}^{9} \rightarrow {\mathbb{R}}^{9}
\label{equ:matprod_def}
\end{equation}
%
with
%
\begin{equation}
\rotmat{1}{3}
=
\rotmat{1}{2}
\rotmat{2}{3}
\Rightarrow
\rotmato{1}{3}
=
\overline{\prod}\left( \rotmato{1}{2}, \rotmato{2}{3}\right).
\label{equ:matprod}
\end{equation}
%
The transposition operator $\bm{P}_\transp$ is a $9 \times 9$ permutation matrix with
%
\begin{equation}
\rotmat{2}{1}
=
\rotmat{1}{2}^\transp
\Rightarrow
\rotmato{2}{1}
=
\bm{P}_\transp \rotmato{1}{2}.
\end{equation}
%
The Euler angles can be calculated from a rotation matrix in the same way as before using these operators with the notation
%
\begin{equation}
\overline{\bm{\alpha}}(\overline{\bm{R}})
=
\bm{\alpha}(\bm{R}).
\end{equation}
%
Finally applying this to the rotational part of the residual vector Jacobian and using the chain rule for differentiation yields
%
\begin{align}
\frac{\partial}{\partial \bm{q}}\bm{\Phi}_{\mathrm{r}}
&=
\frac{\partial}{\partial \bm{q}} \bm{\alpha}\left(\rotmat{0}{D}^\transp(\bm{x}) \rotmat{0}{E}(\bm{q})\right) \label{equ:grad_Phi_q}\\
&=
\frac{\partial}{\partial \bm{q}} \overline{\bm{\alpha}}\left(\overline{\prod}\left( \rotmato{0}{D}^\transp(\bm{x}), \rotmato{0}{E}(\bm{q})\right)\right) \nonumber \\
&=
%underbrace für Geschweifte Klammern drunter, vphantom nur für vertikale Größe des mittleren Terms
\underbrace{\vphantom{\left(\frac{\partial \overline{\prod}\left(\rotmato{0}{D}^\transp, \rotmato{0}{E}\right)}{\partial \rotmato{0}{E}}\right)}\left(\frac{\partial \overline{\bm{\alpha}}}{\partial \overline{\bm{R}}}\right)}_{\mathrm{I}}
\underbrace{\left(\frac{\partial \overline{\prod}\left(\rotmato{0}{D}^\transp, \rotmato{0}{E}\right)}{\partial \rotmato{0}{E}}\right)}_{\mathrm{II}}
\underbrace{\vphantom{\left(\frac{\partial \overline{\prod}\left(\rotmato{0}{D}^\transp, \rotmato{0}{E}\right)}{\partial \rotmato{0}{E}}\right)}\left(\frac{\partial \rotmato{0}{E}(\bm{q})}{\partial \bm{q}} \right)}_{\mathrm{III}}.  \nonumber
\end{align}
The translational part $\bm{\Phi}_{\mathrm{t},\partial\bm{q}}=\partial \bm{\Phi}_{\mathrm{t}} / \partial \bm{q}=\bm{\Psi}_{\mathrm{t},\partial\bm{q}}$ is enclosed in the geometric Jacobian of the manipulator and is not regarded at this point to focus on the rotational aspects.
The gradient 
$\bm{\Psi}_{\mathrm{r}, \partial\bm{q}}=\partial \bm{\Psi}_{\mathrm{r}} / \partial \bm{q}=\bm{P}_{\Psi}\bm{\Phi}_{\mathrm{r},\partial\bm{q}}$
is obtained from the results of (\ref{equ:grad_Phi_q}) with the selection matrix $\bm{P}_{\Psi}$ from (\ref{equ:Psir_def}).

The two first partial derivatives ``I'' and ``II'' from (\ref{equ:grad_Phi_q}) are sparse matrices and can be calculated efficiently as shown in appendix \ref{sec:appendix_gradient_matrix}.
The last partial derivative ``III'' can be derived efficiently with computer algebra systems.

If a rotation $\rotmato{0}{N}(\bm{q})$ to the last robot link frame and a constant rotation $\rotmato{N}{E}$ to the end-effector frame are used to account for exchangeable end-effectors or tools, the properties of the column-operator can be used to substitute the last term ``III'' in (\ref{equ:grad_Phi_q}) with
%
\begin{align}
\frac{\partial \rotmato{0}{E}(\bm{q})}{\partial \bm{q}} 
&=
\frac{\partial}{\partial \bm{q}} \overline{\prod}\left( \rotmato{0}{N}(\bm{q}), \rotmato{N}{E}\right) \label{equ:ee_rotation_gradq}\\
&=
\underbrace{\left(\frac{\partial}{\partial \rotmato{0}{N}} \overline{\prod}\left( \rotmato{0}{N}, \rotmato{N}{E}\right)\right)}_{\mathrm{I}}
\underbrace{\left(\frac{\partial}{\partial \bm{q}} \rotmato{0}{N}(\bm{q})\right)}_{\mathrm{II}}. \nonumber
\end{align}

\section{Resolving functional Redundancy for 3T2R Tasks}
\label{sec:ResFuncRed}

%with $\mathrm{dim}(\bm{\Psi})=5$

The inverse kinematics formalism (\ref{equ:deltaq_psi}) described in the previous section \ref{sec:RecEulAng_3T2R_app} does not yet take into account the functional redundancy.

The typical scenario for 3T2R tasks in industry is a serial link robot with $\mathrm{dim}(\bm{q})>5$.
Most commonly a classical industrial robot with $\mathrm{dim}(\bm{q})=6$ will be used.
Since $\mathrm{dim}(\bm{\Psi})=5$ at least one DoF is free for optimization of additional criteria.

For the sake of simplicity as an additional criterion the summed $\bm{W}$-weighted quadratic distances
%
\begin{equation}
h(\bm{q})
=
\frac{1}{2} (\bm{q}-\bar{\bm{q}})^\transp\bm{W}(\bm{q}-\bar{\bm{q}})
\end{equation}  
%
of the joint positions $\bm{q}$ from their respective reference position $\bar{\bm{q}}$ will be used.
Minimizing $h(\bm{q})$ avoids the risk of joints reaching their technical limits.
The gradient
%
\begin{equation}
h_{\partial\bm{q}}
=
\frac{\partial h}{\partial \bm{q}}
=
\bm{W}(\bm{q}-\bar{\bm{q}})
\end{equation}
%
can be used to include this additional minimization into the solution of the inverse kinematics.
The gradient $h_{\partial\bm{q}}=\partial h/\partial \bm{q}$ is projected into the nullspace of $\bm{\Psi}_{\partial\bm{q}}=\partial \bm{\Psi}/\partial \bm{q}$ with
%
\begin{align}
\bm{\Delta}\bm{q}
&=
\bm{\Delta}\bm{q}_{\mathrm{T}} + \bm{\Delta}\bm{q}_{\mathrm{N}} \nonumber \\
&=
\bm{\Psi}_{\partial\bm{q}}^{\dagger} (-\bm{\Psi}) +  (\bm{1}-\bm{\Psi}_{\partial\bm{q}}^{\dagger}\bm{\Psi}_{\partial\bm{q}}) \bm{h}_{\partial\bm{q}}
\label{equ:nullspace}
\end{align}
%
where the nullspace incremental motion $\bm{\Delta}\bm{q}_{\mathrm{N}}$ does not affects the task achievement ensured via $\bm{\Delta}\bm{q}_{\mathrm{T}}$ \cite{Yoshikawa1984}.

It is reported in \cite{GuoDonKe2015} that their optimization does not work for industrial robots where the tool axis is aligned parallel to the last robot joint axis.
This ``pointing configuration'' can also not be addressed by the nullspace projection from (\ref{equ:nullspace}), since the nullspace corresponds to the last robot axis and (in the case of a six-DoF robot)
%
\begin{equation}
\bm{1}-\bm{\Psi}_{\partial\bm{q}}^{\dagger}\bm{\Psi}_{\partial\bm{q}}
=
\begin{bmatrix}
\bm{0}_{5 \times 5} & \bm{0}_{5 \times 1} \\
\bm{0}_{1 \times 5} & 1_{1 \times 1}
\end{bmatrix}
\end{equation}
%
only projects the gradient $h_{\partial\bm{q}}$ of additional criteria onto the last joint.
Therefore the method does only work if the tool is mounted in a different configuration (``side'' or ``hanging'' in \cite{GuoDonKe2015}), which might be unfavorable for some end-effectors or tasks.

\section{Application on Kinematic Constraint Equations of Parallel Robots}
\label{sec:ParRobKinConstr}

Kinematic constraint equations are used for parallel kinematic machines (``PKM'') to relate end-effector and joint velocities, actuator and end-effector forces or to solve the inverse kinematics problem.

% Quelle: Merlet2006, S. 96
Usually only the translational part of the constraint equations is defined and only the joint positions, joint velocities and joint forces associated with the translational motion are calculated.
This leads to kinematic models where the platform coupling joints are canceled out of the equations. These joints are predominantly passive spherical joints for spatial PKM and passive rotational joints for planar PKM and their kinematic state is generally not of any interest \cite{Merlet2006}.

In the following, the definitions for $\bm{x}$ still hold from  (\ref{equ:xt_def}),\,(\ref{equ:xr_def_rotmat}),\,(\ref{equ:xr_def}), but they now refer to the base frame $\ks{0}$ and the end-effector frame $\ks{D}$ of the whole PKM instead just of single kinematic chains.
The end-effector frame expressed with the task frame coordinates $\bm{x}$ is denoted with ``D'' to comply with the notation from Sec.\,\ref{sec:RecEulAng} used for the inverse kinematics problem of serial chain robots.


The most common kinematic constraint equation 
%
\begin{equation}
\bm{\Phi}_{\mathrm{t}_i}(\bm{q}_i,\bm{x}) = - \ortvek{0}{r}{}{A_iB_i}(\bm{x}) + \ortvek{0}{r}{}{A_iB_i}(\bm{q}_i) 
\end{equation}
%
for leg $i$ is derived from the position of the platform coupling point $B_i$ relative to the base coupling point $A_i$ \cite{Merlet2006}.
The second term $\ortvek{0}{r}{}{A_iB_i}(\bm{q}_i)$ corresponds to the forward kinematics of the serial chain. 
The vector
\begin{equation}
\ortvek{0}{r}{}{A_iB_i}(\bm{x}) = 
- \ortvek{0}{r}{}{0A_i}
+ \bm{x}_{\mathrm{t}} + \rotmat{0}{D}(\bm{x}_{\mathrm{r}}) \ortvek{D}{r}{}{DB_i}
\end{equation}
%
includes the term $\rotmat{0}{D}(\bm{x}_{\mathrm{r}})$ that depends on the full  orientation $\bm{x}_{\mathrm{r}}$ of the end-effector with the rotation about the tool axis in 3T2R tasks.
For a formulation without the tool axis rotation a different constraint definition
%
\begin{equation}
\bm{\Phi}_{\mathrm{t}_i}(\bm{q}_i,\bm{x}) = 
\ortvek{0}{r}{}{DE}(\bm{q}_i,\bm{x}) =
- \bm{x}_{\mathrm{t}} + \ortvek{0}{r}{}{0E}(\bm{q}_i) 
\end{equation}
%
similar to (\ref{equ:Phit_def}) with the vector from the robot base frame $\ks{0}$ to the PKM end-effector $\ks{D}$ can be used where 
only the translational part $\bm{x}_{\mathrm{t}}$ of the end-effector coordinates appears and not the rotational part $\bm{x}_{\mathrm{r}}$.
As a drawback, all joint angles $\bm{q}_i$ of the leg $i$ and not only the coordinates of the first joints counted from the base are now included
in the vector
%
\begin{equation}
\ortvek{0}{r}{}{0E}(\bm{q}_i) = 
\ortvek{0}{r}{}{0A_i}
+ \ortvek{0}{r}{}{A_iB_i}(\bm{q}_i) + \rotmat{0}{B_i}(\bm{q}_i) \ortvek{B_i}{r}{}{B_iE}.
\end{equation}
%
To account for the increased number of included joints, also the rotational part of the kinematic constraints is needed to generate enough equations for an invertible Jacobian.

Here again the definition 
%
\begin{align}
\bm{\Phi}_{\mathrm{r}_i}(\bm{q},\bm{x})
=\bm{\alpha}\left(\rotmat{0}{D}^\transp (\bm{x}_{\mathrm{r}})\rotmat{0}{E}(\bm{q})\right)
\end{align}
%
from (\ref{equ:Phir_def}) is used.
The set of constraints $\bm{\Phi}_{i}$ for each leg of the PKM can again be reduced to $\bm{\Psi}_{i}$ by removing the superfluous rotational component\footnote{The following steps can also be performed using $\bm{\Psi}$, but $\bm{\Phi}$ is used for simplifying the equations.} in case of a 3T2R task, as described in Sec.\,\ref{sec:RecEulAng_3T2R_app}.

The constraint equations
%
\begin{equation}
\bm{\Phi}
=
\begin{bmatrix}
\bm{\Phi}_1 \\
\bm{\Phi}_2 \\
\vdots \\
\bm{\Phi}_m \\
\end{bmatrix}
\end{equation}
%
of the PKM are assembled for all $m$ legs.
% The constraints $\bm{\Phi}$ and $\bm{\Psi}$ can be used interchangeably.
The differential kinematics of the PKM is calculated with the time derivative
%
\begin{equation}
\frac{\mathrm{d}}{{\mathrm{d}}t} \bm{\Phi}(\bm{q},\bm{x})
=
\bm{\Phi}_{\partial \bm{q}}  \dot{\bm{q}}
+
\bm{\Phi}_{\partial \bm{x}} \dot{\bm{x}}
\end{equation}
%
where the diagonal elements $\bm{\Phi}_{i,\partial \bm{q}}=\partial \bm{\Phi}_i / \partial \bm{q}_i$ of the direct kinematics Jacobian
%
\begin{equation}
\bm{\Phi}_{\partial \bm{q}}
=
\frac{\partial \bm{\Phi}}{\partial \bm{q}}
=
\begin{bmatrix}
\bm{\Phi}_{1,\partial \bm{q}}  & 0 & 0 & 0\\
0 & \bm{\Phi}_{2,\partial \bm{q}} & \ddots & 0  \\
0 & \ddots & \ddots & 0  \\
0 & 0 & 0 &\bm{\Phi}_{m,\partial \bm{q}}
\end{bmatrix}
\label{equ:PKM_phi_grad_q}
\end{equation}  
%
correspond to the residual vector Jacobian (\ref{equ:grad_Phi_q}) from Sec.\,\ref{sec:RecEulAng}.
The calculation of the inverse kinematics Jacobian
%
\begin{equation}
\bm{\Phi}_{\partial \bm{x}}
=
\frac{\partial \bm{\Phi}}{\partial \bm{x}}
=
\begin{bmatrix}
\partial \bm{\Phi}_1/\partial \bm{x}\\
\partial \bm{\Phi}_2/\partial \bm{x}\\
\vdots \\
\partial \bm{\Phi}_m/\partial \bm{x}\\
\end{bmatrix}
\label{equ:PKM_phi_grad_x}
\end{equation}  
%
can be simplified similar to the process described in Sec.\,\ref{sec:RecEulAng_implement} with
%
\begin{align}
\frac{\partial}{\partial \bm{x}_{\mathrm{r}}}\bm{\Phi}_{\mathrm{r}_i}
&=
\frac{\partial}{\partial \bm{x}_{\mathrm{r}}} \bm{\alpha}\left(\left(\rotmat{0}{E}^\transp(\bm{q}_i) \rotmat{0}{D}(\bm{x}_{\mathrm{r}})\right)^\transp\right) \label{equ:grad_Phi_x} \\
&=
\frac{\partial}{\partial \bm{x}_{\mathrm{r}}} \overline{\bm{\alpha}}\left(
\bm{P}_{\mathrm{T}}
\overline{\prod}\left( \rotmato{0}{E}^\transp(\bm{q}_i), \rotmato{0}{D}(\bm{x}_{\mathrm{r}})\right)\right) \nonumber \\
&=
%underbrace für Geschweifte Klammern drunter, vphantom nur für vertikale Größe des dritten Terms
\underbrace{\vphantom{\frac{\partial \overline{\prod}\left( \rotmato{0}{E}^\transp, \rotmato{0}{D}\right)}{\partial \rotmato{0}{D}}}
    \frac{\partial \overline{\bm{\alpha}}}{\partial \overline{\bm{R}}}}_{\mathrm{I}}
\underbrace{\vphantom{\frac{\partial \overline{\prod}\left( \rotmato{0}{E}^\transp, \rotmato{0}{D}\right)}{\partial \rotmato{0}{D}}}
    \bm{P}_{\mathrm{T}}}_{\mathrm{II}}
\underbrace{\frac{\partial \overline{\prod}\left( \rotmato{0}{E}^\transp, \rotmato{0}{D}\right)}{\partial \rotmato{0}{D}}}_{\mathrm{III}}
\underbrace{\frac{\partial \rotmato{0}{D}(\bm{x}_{\mathrm{r}})}{\partial \bm{x}_{\mathrm{r}}}}_{\mathrm{IV}} \nonumber
\end{align}
%
where the simplicity of the single expression is demonstrated in appendix\,\ref{sec:appendix_gradient_matrix}.

Again, only the rotational component $\bm{\Phi}_{\mathrm{r}_i,\partial \bm{x}_{\mathrm{r}}}$ of 
%
\begin{equation}
\partial \bm{\Phi}_i/\partial \bm{x}
=
\begin{bmatrix}
\partial\bm{\Phi}_{\mathrm{t}_i}/\partial \bm{x}_{\mathrm{t}} & \partial\bm{\Phi}_{\mathrm{t}_i}/\partial \bm{x}_{\mathrm{r}} \\
\bm{0} & \partial\bm{\Phi}_{\mathrm{r}_i}/\partial \bm{x}_{\mathrm{r}} \\
\end{bmatrix}
\end{equation}
is regarded due to the focus on rotation in this paper.

Using $\bm{\Psi}_{\partial \bm{q}}$ and $\bm{\Psi}_{\partial \bm{x}}$ in (\ref{equ:PKM_phi_grad_q}) and (\ref{equ:PKM_phi_grad_x}) for 3T2R tasks promises to improve motion planning and controllers by calculating actuator forces considering the tool symmetry and allowing the incorporation of nullspace movements and forces.

\section{Conclusions}
\label{sec:Conclusion}

This paper presented a novel concept to formulate the inverse kinematics problem of serial kinematic chains using reciprocal Euler angles.
This exploits the properties of Euler angles to reduce the number of coordinates required for 3T2R tasks which are of high industrial relevance.
Applications to the inverse kinematics of serial robots and the kinematic constraint equations of parallel robots are given.
The detailed view on the practical implementation aims at facilitating the understanding of the approach and at reducing the barrier for potential users.

Future work includes comparative simulative evaluation against state of the art methods and inquiries on singularities and the relation to the geometric Jacobian.

\section{APPENDIX}

\subsection{Influence of Reciprocal Euler angles}
\label{sec:appendix_eulerreciproc}

This section derives the effect of the reciprocity of Euler-angles at the example of the kinematics description of Sec.\,\ref{sec:RecEulAng} and the frames of Fig.\,\ref{fig:frames_6dof}.

An end-effector orientation $\bm{\beta}=\bm{x}_{\mathrm{r}}$ gives the rotation matrix\footnote{The matrix rotates vectors from $\ks{E}$ to $\ks{D}$} from the actual end-effector frame $\ks{E}$ to the desired end-effector frame $\ks{D}$
%
\begin{equation}
\rotmat{D}{E}(\bm{\beta},\bm{q})
= 
\rotmat{0}{D}^\transp (\bm{\beta})\rotmat{0}{E}(\bm{q})
\label{equ:orierr_1_rotmat}
\end{equation}
%
where using the $X$-$Y$-$Z$-Euler angles yields
%
\begin{equation}
\rotmat{0}{D}^\transp(\bm{\beta})
=
\bm{R}_z(-\beta_3) \bm{R}_y(-\beta_2) \bm{R}_x(-\beta_1)
\end{equation}
%
as introduced in (\ref{equ:def_rmat_xyz}).
With an additional rotation $-\delta$ around the $z$-axis for the desired orientation, the resulting new Euler angles are
%
\begin{equation}
\beta_1'=\beta_1,  \quad \beta_2'=\beta_2,  \quad \beta_3'=\beta_3-\delta.
\end{equation}
%
The additional rotation corresponds to the tool axis defined in Sec.\,\ref{sec:RecEulAng} % and does not influence 3T2R tasks.
and leads to a new residual orientation error expressed as a rotation matrix
%
\begin{align}
\rotmat{D}{E}(\bm{\beta}',\bm{q})
&=
\rotmat{0}{D}^\transp (\bm{\beta}') \rotmat{0}{E}(\bm{q}) \nonumber\\
&=
\left(\rotmat{0}{D}(\bm{\beta})\bm{R}_z(-\delta)\right)^\transp \rotmat{0}{E}(\bm{q}) \nonumber \\
&=
\bm{R}_z(\delta) \rotmat{0}{D}^\transp (\bm{\beta}) \rotmat{0}{E}(\bm{q}) \nonumber \\
&=
\bm{R}_z(\delta) \rotmat{D}{E}(\bm{\beta},\bm{q}).
\label{equ:orierr_2_rotmat}
\end{align}

The first residual orientation error from (\ref{equ:orierr_1_rotmat}) corresponding to $\bm{\beta}$ is defined as a rotation matrix
%
% Quelle: equations/R1.txt (aus ikfr_paper_equations.mw)
\begin{align}
\rotmat{D}{E}(\bm{\beta},\bm{q})
=
\begin{bmatrix}
{n_x}&{o_x}&{a_x} \\
{n_y}&{o_y}&{a_y} \\ 
{n_z}&{o_z}&{a_z} \\ 
\end{bmatrix}
\label{equ:orierr_1_rotmat_def}
\end{align}
%
and as a $Z$-$Y$-$X$-Euler angle representation
%
% Quelle: equations/alpha1.txt (aus ikfr_paper_equations.mw)
\begin{align}
\bm{\alpha} =
\begin{bmatrix}
\arctan \left( {n_y} / { n_x} \right) \\ 
\arctan \left( -{n_z} / \sqrt {{{a_z}}^{2}+{{ o_z}}^{2}} \right) \\ 
\arctan \left( {o_z} / {a_z} \right)
\end{bmatrix}.
\label{equ:alpha_xyz}
\end{align}

The second error corresponding to $\bm{\beta}'$ only differs regarding the additional rotation $\delta$. Combining (\ref{equ:orierr_2_rotmat}) and (\ref{equ:orierr_1_rotmat_def}) leads to
%
% Quelle: equations/R2.txt (aus ikfr_paper_equations.mw)
\begin{align}
&\rotmat{D}{E}(\bm{\beta}',\bm{q})
= \\
&\left[ \begin {array}{ccc} { C_{\delta}}\,{n_x}-{ S_{\delta}}\,{ n_y}&{ C_{\delta}}\,{o_x}-{ S_{\delta}}\,{o_y}&{ C_{\delta}}\,{ a_x}-{ S_{\delta}}\,{a_y}\\ \noalign{\medskip}{ C_{\delta}}\,{n_y}+ { S_{\delta}}\,{n_x}&{ C_{\delta}}\,{o_y}+{ S_{\delta}}\,{o_x}&{  C_{\delta}}\,{a_y}+{ S_{\delta}}\,{a_x}\\ \noalign{\medskip}{ n_z}&{o_z}&{a_z}\end {array} \right] \nonumber
\end{align}
%
where $C_{\delta}=\mathrm{cos}(\delta)$ and $S_{\delta}=\mathrm{sin}(\delta)$.
The $Z$-$Y$-$X$-Euler angles from this rotation matrix are
%
% Quelle: equations/alpha2.txt (aus ikfr_paper_equations.mw)
\begin{equation}
\bm{\alpha}' =
\begin{bmatrix}
\arctan \left( ({  C_{\delta}}\,{n_y}+{ S_{\delta}}\,{n_x}) / ({ C_{\delta}}\,{n_x}-{  S_{\delta}}\,{n_y}) \right) \\
\arctan \left( -{n_z} / \sqrt {{{a_z}}^{2}+{{ o_z}}^{2}} \right) \\
\arctan \left( {o_z} / {a_z} \right)
\end{bmatrix}
\end{equation}
%
where $\delta$  only influences the first component $\alpha_1$.
This allows the conclusion, that $\beta_3$ only influences $\alpha_1$ and results in the dependencies
%
\begin{align}
\alpha_1'&=\alpha_1'(\bm{q},\beta_1,\beta_2,\beta_3)\\
\alpha_2'&=\alpha_2'(\bm{q},\beta_1,\beta_2) =\alpha_2\\
\alpha_3'&=\alpha_3'(\bm{q},\beta_1,\beta_2) =\alpha_3
\end{align}
%
already displayed in (\ref{equ:alpha_dep_beta}) with the consequences for the kinematic modeling of robots in 3T2R tasks described in Sec.\,\ref{sec:RecEulAng_effect}.

\subsection{Matrix Operations for Partial Derivatives}
\label{sec:appendix_gradient_matrix}

The single expressions derived in Sec.\,\ref{sec:RecEulAng_implement} for the serial chains and in Sec.\,\ref{sec:ParRobKinConstr} for the parallel chains can be calculated with low computational effort from the definition of the $X$-$Y$-$Z$- and $Z$-$Y$-$X$-Euler angles from (\ref{equ:def_rmat_xyz}), (\ref{equ:def_rmat_zyxr}) and (\ref{equ:alpha_xyz}).
With $\overline{\bm{R}}=[n_x,n_y,n_z ,o_x,o_y,o_z,a_x,a_y,a_z]^\transp$ the gradient ``I'' in (\ref{equ:grad_Phi_q}) becomes
% Quelle: equations/dalphadRb.txt (aus ikfr_paper_equations.mw)
\begin{equation}
\left(\frac{\partial \overline{\bm{\alpha}}}{\partial \overline{\bm{R}}}\right)^\transp
=
 \left[ \begin {array}{ccc} -{\frac {{n_y}}{{{n_x}}^{2}+{{n_y }}^{2}}}&0&0\\ \noalign{\medskip}{\frac {{n_x}}{{{n_x}}^{2}+{{ n_y}}^{2}}}&0&0\\ \noalign{\medskip}0&-\sqrt {{{a_z}}^{2}+{{ o_z}}^{2}}&0\\ \noalign{\medskip}0&0&0\\ \noalign{\medskip}0&0&0 \\ \noalign{\medskip}0&{\frac {{n_z}\,{o_z}}{\sqrt {{{a_z}}^{ 2}+{{o_z}}^{2}}}}&{\frac {{a_z}}{{{a_z}}^{2}+{{o_z}}^{2}}} \\ \noalign{\medskip}0&0&0\\ \noalign{\medskip}0&0&0 \\ \noalign{\medskip}0&{\frac {{n_z}\,{a_z}}{\sqrt {a_z^{2}+{{o_z}}^{2}}}}&-{\frac {o_z}{a_z^{2}+o_z^{2}} }\end {array} \right] 
\end{equation}
%
and the inverse gradient ``I'' in (\ref{equ:grad_Phi_x}) yields
%
% Quelle: equations/R2b_dxyz.txt (aus ikfr_paper_equations.mw)
\begin{align}
&\left(\frac{\partial \overline{\bm{R}}(\overline{\bm{\beta}})}{\partial \overline{\bm{\beta}}}\right)
=\\
\small
&\begin{bmatrix}
0&-{ S_2}\,{ C_3}&-{ C_2}\,{ S_3}
\\ { C_1}\,{ S_2}\,{ C_3}-{ S_1}\,{ S_3}&{
    S_1}\,{ C_2}\,{ C_3}&-{ S_1}\,{ S_2}\,{ S_3}+{ C_1}\,{
    C_3}\\ { S_1}\,{ S_2}\,{ C_3}+{ C_1}\,{
    S_3}&-{ C_1}\,{ C_2}\,{ C_3}&{ C_1}\,{ S_2}\,{ S_3}+{
    S_1}\,{ C_3}\\ 0&{ S_2}\,{ S_3}&-{ C_2}\,
{ C_3}\\ -{ C_1}\,{ S_2}\,{ S_3}-{ S_1}\,{
    C_3}&-{ S_1}\,{ C_2}\,{ S_3}&-{ S_1}\,{ S_2}\,{ C_3}-{
    C_1}\,{ S_3}\\ -{ S_1}\,{ S_2}\,{ S_3}+{
    C_1}\,{ C_3}&{ C_1}\,{ C_2}\,{ S_3}&{ C_1}\,{ S_2}\,{
    C_3}-{ S_1}\,{ S_3}\\ 0&{ C_2}&0
\\ -{ C_1}\,{ C_2}&{ S_1}\,{ S_2}&0
\\ -{ S_1}\,{ C_2}&-{ C_1}\,{ S_2}&0
\end {bmatrix}  \nonumber
\end{align}
%
with $C_i=\mathrm{cos}(\beta_i)$, $S_i=\mathrm{sin}(\beta_i)$.
The gradient of the matrix product (\ref{equ:matprod}) w.r.t. the second factor used in (\ref{equ:grad_Phi_x}) term ``III'' and (\ref{equ:grad_Phi_q}) term ``II'' is
%
\begin{equation}
\frac{\partial }{\partial \overline{\bm{R}}_2}
\overline{\prod}\left( \overline{\bm{R}}_1, \overline{\bm{R}}_2\right)
=
\begin{bmatrix}
\bm{R}_1 & \bm{0} & \bm{0} \\
\bm{0} & \bm{R}_1 & \bm{0} \\
\bm{0} & \bm{0} & \bm{R}_1  \\
\end{bmatrix}
\end{equation}
%
and the gradient w.r.t. the first factor used in (\ref{equ:ee_rotation_gradq}) term ``I'' is
%
\begin{equation}
\frac{\partial }{\partial \overline{\bm{R}}_1}
\overline{\prod}\left( \overline{\bm{R}}_1, \overline{\bm{R}}_2\right)
=
\begin{bmatrix}
{\mathrm{diag}}(n_x)&{\mathrm{diag}}(o_x)&{\mathrm{diag}}(a_x) \\ {\mathrm{diag}}(n_y)&{\mathrm{diag}}(o_y)&{\mathrm{diag}}(a_y)\\ {\mathrm{diag}}(n_z)&{\mathrm{diag}}(o_z)&{\mathrm{diag}}(a_z)
\end{bmatrix}
\end{equation}
%
where $n_x,n_y,...$ are the entries of $\bm{R}_2$ and the $\mathrm{diag}$-matrices are $3 \times 3$.
\section{Acknowledgements}

The financial support from the Deutsche Forschungsgemeinschaft (German Research Foundation, DFG) under grant number OR 196/33-1 is gracefully acknowledged.

% BIBLIOGRAPHY
\bibliographystyle{ieeetr}
\bibliography{ikfr_ref}

\end{document}
